{
  "title": "在Linux CentOS上编译并安装Clang 3.5.0",
  "cells": [
    {
      "type": "text",
      "data": "<h1 class=\"postTitle\" style=\"color: rgb(0, 0, 0); margin: 20px 0px 10px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); font-size: 14px; font-family: Verdana, Arial, Helvetica, sans-serif;\"><a id=\"cb_post_title_url\" class=\"postTitle2\" href=\"http://www.cnblogs.com/dudu/p/4294374.html\" style=\"margin: 0px; padding: 0px; text-decoration: none; color: rgb(0, 0, 0);\">在Linux CentOS上编译并安装Clang 3.5.0</a></h1><div class=\"clear\" style=\"color: rgb(0, 0, 0); margin: 0px; padding: 0px; clear: both; font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 19px;\"></div><div class=\"postBody\" style=\"margin: 0px; padding: 0px; color: rgb(17, 17, 17); line-height: 1.8; font-family: Verdana, Arial, Helvetica, sans-serif;\"><div id=\"cnblogs_post_body\" style=\"margin: 0px 0px 20px; padding: 0px; word-break: break-word;\"><p style=\"margin: 10px auto; padding: 0px;\">编译CoreCLR需要Clang 3.5，而CentOS上安装的是Clang 3.4.2（yum repos中最新版也是这个），只能自己手工编译LLVM的源代码进行安装。</p><p style=\"margin: 10px auto; padding: 0px;\">(注：CentOS的版本是6.6)</p><p style=\"margin: 10px auto; padding: 0px;\">一、安装libstdc++4.7</p><p style=\"margin: 10px auto; padding: 0px;\">(注：如果是CentOS 7.0，不需要这步)</p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">wget <a href=\"http://people.centos.org/tru/devtools-2/devtools-2.repo\">http://people.centos.org/tru/devtools-2/devtools-2.repo</a> -O /etc/yum.repos.d/devtools-2.repo\nyum install devtoolset-2-gcc devtoolset-2-binutils devtoolset-2-gcc-c++\nln -s /opt/rh/devtoolset-2/root/usr/bin/* /usr/local/bin/</pre></div><p style=\"margin: 10px auto; padding: 0px;\">如果不安装，在configure配置编译选项时会出现下面的错误提示：</p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">We detected a missing feature in the standard C++ library that was known to be\nmissing in libstdc++4.6 and implemented in libstdc++4.7. There are numerous\nC++11 problems with 4.6's library, and we don't support GCCs or libstdc++ older\nthan 4.7.</pre></div><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">二、安装Python 2.7.9</span></p><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">(注：如果是CentOS 7.0，不需要这步)</span></p><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">CentOS 6.6自带的是Python 2.6.6，而编译llvm需要Python 2.7以上。</span></p><p style=\"margin: 10px auto; padding: 0px;\">1）安装编译Python需要的包包</p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">yum install zlib-devel\nyum install bzip2-devel\nyum install openssl-devel\nyum install ncurses-devel\nyum install sqlite-devel</pre></div><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">2）下载并解压Python 2.7.9的源代码</span></p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">cd /opt\nwget --no-check-certificate <a href=\"https://www.python.org/ftp/python/2.7.9/Python-2.7.9.tar.xz\">https://www.python.org/ftp/python/2.7.9/Python-2.7.9.tar.xz</a>\ntar xf Python-2.7.9.tar.xz\ncd Python-2.7.9</pre></div><p style=\"margin: 10px auto; padding: 0px;\">3）编译与安装Python 2.7.9</p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">./configure --prefix=/usr/local\nmake &amp;&amp; make altinstall</pre></div><p style=\"margin: 10px auto; padding: 0px;\">4）将python命令指向Python 2.7.9</p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">ln -s /usr/local/bin/python2.7 /usr/local/bin/python</pre></div><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">三、添加交换分区</span></p><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">如果编译的机器内存比较小，建议添加交换分区。我当时测试的机器只有1G内存，在编译过程中出现了“c++: internal compiler error: Killed (program cc1plus)”错误。</span></p><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">1）创建并激活交换文件（比如2G）：</span>&nbsp;</p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">dd if=/dev/zero of=/swapfile bs=1k count=2048000\nmkswap /swapfile\nswapon /swapfile</pre></div><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">2）修改 /etc/fstab 文件让交换文件启动时自动加载，添加如下内容：</span>&nbsp;</p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">/swapfile               swap                    swap    defaults        0 0</pre></div><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">四、编译LLVM</span></p><p style=\"margin: 10px auto; padding: 0px;\">1）下载llvm的源代码</p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\"><a href=\"http://llvm.org/releases/3.5.0/llvm-3.5.0.src.tar.xz\">http://llvm.org/releases/3.5.0/llvm-3.5.0.src.tar.xz</a>\nmv llvm-3.5.0.src llvm</pre></div><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">2）下载clang的源代码</span></p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">cd llvm/tools\nwget <a href=\"http://llvm.org/releases/3.5.0/cfe-3.5.0.src.tar.xz\">http://llvm.org/releases/3.5.0/cfe-3.5.0.src.tar.xz</a>\ntar xf cfe-3.5.0.src.tar.xz\nmv cfe-3.5.0.src clang</pre></div><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">3）下载compiler-rt的源代码</span></p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">cd ../projects\nwget <a href=\"http://llvm.org/releases/3.5.0/compiler-rt-3.5.0.src.tar.xz\">http://llvm.org/releases/3.5.0/compiler-rt-3.5.0.src.tar.xz</a>\ntar xf compiler-rt-3.5.0.src.tar.xz\nmv compiler-rt-3.5.0.src compiler-rt</pre></div><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">4）配置编译选项</span></p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">cd ..<br style=\"margin: 0px; padding: 0px;\">./configure --enable-optimized CC=gcc CXX=g++</pre></div><p style=\"margin: 10px auto; padding: 0px;\">5）编译llvm</p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">make -j2</pre></div><p style=\"margin: 10px auto; padding: 0px;\">编译成功后的提示：</p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">llvm[0]: ***** Completed Release+Asserts Build</pre></div><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">6）安装编译好的llvm</span></p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">make install</pre></div><p style=\"margin: 10px auto; padding: 0px;\">会安装在/usr/local/bing中</p><p style=\"margin: 10px auto; padding: 0px;\">7）检查clang的版本</p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\"># clang --version\nclang version 3.5.0 (tags/RELEASE_350/final)</pre></div><p style=\"margin: 10px auto; padding: 0px;\"><span style=\"margin: 0px; padding: 0px; line-height: 1.5;\">如果还是旧版本，需要将/usr/bin/clang指向clang 3.5.0：</span></p><div class=\"cnblogs_code\" style=\"margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important;\"><pre style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; font-family: 'Courier New' !important;\">ls -s /usr/local/bin/clang /usr/bin/clang</pre></div></div></div>"
    }
  ]
}
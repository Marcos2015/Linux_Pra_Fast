{
  "title": "GCC选项_-Wl,-soname",
  "cells": [
    {
      "type": "text",
      "data": "<div style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px; text-align: center;\"><h1 class=\"aTitle\"><br></h1></div><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">-Wl选项告诉编译器将后面的参数传递给链接器。</p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">-soname则指定了动态库的soname(简单共享名，Short for shared object name)</p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">soname的关键功能是它提供了兼容性的标准：</p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">当要升级系统中的一个库时，并且新库的soname和老库的soname一样，用旧库链接生成的程序使用新库依然能正常运行。这个特性使得在Linux下，升级使得共享库的程序和定位错误变得十分容易。</p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">在Linux中，应用程序通过使用soname，来指定所希望库的版本，库作者可以通过保留或改变soname来声明，哪些版本是兼容的，这使得程序员摆脱了共享库版本冲突问题的困扰。</p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">可以通过readelf -d来查看每个动态库的SONAME</p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">1. 声明libto.so.1，并生成libto.so.1.2</p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">[root@localhost c]# gcc -fPIC -shared -Wl,-soname,libto.so.1 -o libto.so.1.2 to.c&nbsp;&nbsp;<br>[root@localhost c]# ls -lh&nbsp;&nbsp;&nbsp;<br>-rwxr-xr-x 1 root root 4268 Jan 10 17:22 libto.so.1.2&nbsp;&nbsp;<br>[root@localhost c]# ldconfig -n ./&nbsp;&nbsp;<br>lrwxrwxrwx 1 root root&nbsp; 12 Jan 10 17:23 libto.so.1 -&gt; libto.so.1.2&nbsp;&nbsp;<br>-rwxr-xr-x 1 root root 4.2K Jan 10 17:22 libto.so.1.2&nbsp;&nbsp;<br>[root@localhost c]# readelf -d libto.so.1.2&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;<br>Dynamic section at offset 0x504 contains 21 entries:&nbsp;&nbsp;<br>&nbsp; Tag&nbsp; &nbsp; &nbsp; &nbsp; Type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Name/Value&nbsp;&nbsp;<br>&nbsp;0x00000001 (NEEDED)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Shared library: [libc.so.6]&nbsp;&nbsp;<br>&nbsp;0x0000000e (SONAME)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Library soname: [libto.so.1]&nbsp;&nbsp;<br>&nbsp;0x0000000c (INIT)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x2cc&nbsp;&nbsp;<br>&nbsp;0x0000000d (FINI)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x4c4&nbsp;&nbsp;<br>&nbsp;0x6ffffef5 (GNU_HASH)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0xb4&nbsp;&nbsp;<br>&nbsp;0x00000005 (STRTAB)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x1b4&nbsp;&nbsp;<br>&nbsp;0x00000006 (SYMTAB)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0xf4&nbsp;&nbsp;<br>&nbsp;0x0000000a (STRSZ)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 150 (bytes)&nbsp;&nbsp;<br>&nbsp;0x0000000b (SYMENT)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 16 (bytes)&nbsp;&nbsp;<br>&nbsp;0x00000003 (PLTGOT)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x15d8&nbsp;&nbsp;<br>&nbsp;0x00000002 (PLTRELSZ)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 24 (bytes)&nbsp;&nbsp;<br>&nbsp;0x00000014 (PLTREL)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REL&nbsp;&nbsp;<br>&nbsp;0x00000017 (JMPREL)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x2b4&nbsp;&nbsp;<br>&nbsp;0x00000011 (REL)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x294&nbsp;&nbsp;<br>&nbsp;0x00000012 (RELSZ)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 32 (bytes)&nbsp;&nbsp;<br>&nbsp;0x00000013 (RELENT)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8 (bytes)&nbsp;&nbsp;<br>&nbsp;0x6ffffffe (VERNEED)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x264&nbsp;&nbsp;<br>&nbsp;0x6fffffff (VERNEEDNUM)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp;&nbsp;<br>&nbsp;0x6ffffff0 (VERSYM)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x24a&nbsp;&nbsp;<br>&nbsp;0x6ffffffa (RELCOUNT)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp;&nbsp;<br>&nbsp;0x00000000 (NULL)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0</p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">总结：程式库主要的升级会破坏相容性；而次要的升级则可能不会；那麽以下面的方式来连结，所有的一切就都会相安无事了。</p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">gcc -shared -Wl,-soname,libfoo.so.major -o libfoo.so.major.minor</p><p style=\"color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; line-height: normal;\"><a href=\"http://www.linuxidc.com/topicnews.aspx?tid=2\" target=\"_blank\" title=\"Ubuntu\">Ubuntu</a>&nbsp;12.04嵌入式交叉编译环境arm-linux-GCC搭建过程图解&nbsp;<a href=\"http://www.linuxidc.com/Linux/2013-06/85902.htm\">http://www.linuxidc.com/Linux/2013-06/85902.htm</a></p><p style=\"color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; line-height: normal;\">Ubuntu 12.10安装交叉编译器arm-none-linux-gnueabi-GCC&nbsp;<a href=\"http://www.linuxidc.com/Linux/2013-03/82016.htm\">http://www.linuxidc.com/Linux/2013-03/82016.htm</a></p><p style=\"color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; line-height: normal;\">Ubuntu下Vim+GCC+GDB安装及使用&nbsp;<a href=\"http://www.linuxidc.com/Linux/2013-01/78159.htm\">http://www.linuxidc.com/Linux/2013-01/78159.htm</a></p><p style=\"color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; line-height: normal;\">Ubuntu下两个GCC版本切换&nbsp;<a href=\"http://www.linuxidc.com/Linux/2012-10/72284.htm\">http://www.linuxidc.com/Linux/2012-10/72284.htm</a></p><p style=\"color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; line-height: normal;\"><span style=\"color: rgb(255, 0, 0);\"><strong>GCC 的详细介绍</strong></span>：<a title=\"GCC\" href=\"http://www.linuxidc.com/Linux/2012-03/57328.htm\">请点这里</a><br><span style=\"color: rgb(255, 0, 0);\"><strong>GCC 的下载地址</strong></span>：<a href=\"http://www.linuxidc.com/down.aspx?id=452\" target=\"_blank\">请点这里</a></p><p style=\"color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; line-height: normal;\"><strong>本文永久更新链接地址</strong>：<a href=\"http://www.linuxidc.com/Linux/2014-11/109309.htm\">http://www.linuxidc.com/Linux/2014-11/109309.htm</a></p>"
    }
  ]
}
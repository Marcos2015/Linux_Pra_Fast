{
  "title": "解决类似 /usr/lib64/libstdc++.so.6: version `GLIBCXX_3.4.21' not found 的问题",
  "cells": [
    {
      "type": "text",
      "data": "<h1 class=\"\" style=\"margin: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei';\">解决类似 /usr/lib64/libstdc++.so.6: version `GLIBCXX_3.4.21' not found 的问题</h1><div class=\"\" style=\"margin: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px;\">&nbsp;2015年10月17日 &nbsp;&nbsp; 4416&nbsp;</div><div class=\"post_content\" style=\"color: rgb(0, 0, 0); font-family: 'microsoft yahei'; font-size: 15px;\"><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\"><a href=\"http://itbilu.com/linux/management/NymXRUieg.html\" class=\"\">http://itbilu.com/linux/management/NymXRUieg.html</a></div><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">源码编译升级安装了<code class=\"\">gcc</code>后，编译程序或运行其它程序时，有时会出现类似<code class=\"\">/usr/lib64/libstdc++.so.6: version `GLIBCXX_3.4.21' not found</code>的问题。这是因为升级<code class=\"\">gcc</code>时，生成的动态库没有替换老版本<code class=\"\">gcc</code>的动态库导致的，将<code class=\"\">gcc</code>最新版本的动态库替换系统中老版本的动态库即可解决。</div><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\"><br class=\"\"></div><h3 class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\"><a name=\"t1\" class=\"\" style=\"color: rgb(12, 137, 207);\"></a>1. 问题原因分析</h3><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">为了安装最新版本的<code class=\"\"><a href=\"http://lib.csdn.net/base/30\" class=\"replace_word\" title=\"Node.js知识库\" target=\"_blank\" style=\"text-decoration: none; color: rgb(223, 52, 52); font-weight: bold;\">Node.js</a></code>（最新版本的<code class=\"\">Node.js</code>使用了<code class=\"\">C++ 11</code>中，而<code class=\"\">C++ 11</code>需要code&gt;gcc 4.8+才能支持），将<code class=\"\">gcc</code>升级到了当前最新版本<code class=\"\">v 5.2.0</code>。升级后，成功编译安装了新版本的<code class=\"\">Node.js</code>（<code class=\"\">v 4.2.1</code>）,但运行时程序时出现了以下错误：</div><pre class=\"\" style=\"color: rgb(85, 85, 85); white-space: pre-wrap; word-wrap: break-word;\">node: /usr/lib64/libstdc++.so.6: version `GLIBCXX_3.4.21' not found (required by node)\nnode: /usr/lib64/libstdc++.so.6: version `GLIBCXX_3.4.15' not found (required by node)\nnode: /usr/lib64/libstdc++.so.6: version `GLIBCXX_3.4.20' not found (required by node)</pre><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">运行以下命令检查动态库：</div><pre class=\"\" style=\"color: rgb(85, 85, 85); white-space: pre-wrap; word-wrap: break-word;\">strings /usr/lib64/libstdc++.so.6 | grep GLIBC</pre><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\"><br class=\"\"></div><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">输出结果如下：</div><pre class=\"\" style=\"color: rgb(85, 85, 85); white-space: pre-wrap; word-wrap: break-word;\">GLIBCXX_3.4\nGLIBCXX_3.4.1\nGLIBCXX_3.4.2\nGLIBCXX_3.4.3\nGLIBCXX_3.4.4\nGLIBCXX_3.4.5\nGLIBCXX_3.4.6\nGLIBCXX_3.4.7\nGLIBCXX_3.4.8\nGLIBCXX_3.4.9\nGLIBCXX_3.4.10\nGLIBCXX_3.4.11\nGLIBCXX_3.4.12\nGLIBCXX_3.4.13\nGLIBCXX_FORCE_NEW\nGLIBCXX_DEBUG_MESSAGE_LENGTH</pre><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">从以上输出可以看出，<code class=\"\">gcc</code>的动态库还是旧版本的。说明出现这些问题，是因为升级<code class=\"\">gcc</code>时，生成的动态库没有替换老版本<code class=\"\">gcc</code>的动态库。</div><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\"><br class=\"\"></div><h3 class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\"><a name=\"t2\" class=\"\" style=\"color: rgb(12, 137, 207);\"></a>2. 问题处理</h3><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">执行以下命令，查找编译<code class=\"\">gcc</code>时生成的最新动态库：</div><pre class=\"\" style=\"color: rgb(85, 85, 85); white-space: pre-wrap; word-wrap: break-word;\">find / -name \"libstdc++.so*\"</pre><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">输出如下：</div><pre class=\"\" style=\"color: rgb(85, 85, 85); white-space: pre-wrap; word-wrap: break-word;\">/home/gcc-5.2.0/gcc-temp/stage1-x86_64-unknown-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so\n/home/gcc-5.2.0/gcc-temp/stage1-x86_64-unknown-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6\n/home/gcc-5.2.0/gcc-temp/stage1-x86_64-unknown-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.21  //最新动态库\n……\n</pre><pre class=\"\" style=\"color: rgb(85, 85, 85); white-space: pre-wrap; word-wrap: break-word;\"><br class=\"\"></pre><pre class=\"\" style=\"color: rgb(85, 85, 85); white-space: pre-wrap; word-wrap: break-word;\"><br class=\"\"></pre><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\"><code class=\"\">/home/gcc-5.2.0/gcc-temp</code>是<a target=\"_blank\" href=\"http://itbilu.com/linux/management/V1vdnt9ll.html\" class=\"\" style=\"text-decoration: none; color: rgb(12, 137, 207);\">升级gcc</a>时的输出目录。</div><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">将上面的最新动态库<code class=\"\">libstdc++.so.6.0.21</code>复制到<code class=\"\">/usr/lib64</code>目录下：</div><pre class=\"\" style=\"color: rgb(85, 85, 85); white-space: pre-wrap; word-wrap: break-word;\">cp /home/gcc-5.2.0/gcc-temp/stage1-x86_64-unknown-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.21 /usr/lib64</pre><div class=\"\" style=\"margin: 0px; padding: 0px;\"><pre class=\"\" style=\"white-space: pre-wrap; word-wrap: break-word;\"><font color=\"#ff40ff\" class=\"\">我自己电脑gcc版本是gcc-6.2.0</font></pre><pre class=\"\" style=\"white-space: pre-wrap; word-wrap: break-word;\"><font color=\"#ff40ff\" class=\"\">cp /usr/local/gcc-6.2.0/lib64/libstdc++.so.6.0.22  /usr/lib64/</font></pre><div class=\"\" style=\"color: rgb(85, 85, 85);\"><br class=\"\"></div></div><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">复制后，修改系统默认动态库的指向，即：重建默认库的软连接。</div><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">切换工作目录至<code class=\"\">/usr/lib64</code>：</div><pre class=\"\" style=\"color: rgb(85, 85, 85); white-space: pre-wrap; word-wrap: break-word;\">cd /usr/lib64</pre><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">删除原来软连接：</div><pre class=\"\" style=\"color: rgb(85, 85, 85); white-space: pre-wrap; word-wrap: break-word;\">rm -rf libstdc++.so.6</pre><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">将默认库的软连接指向最新动态库：</div><pre class=\"\" style=\"white-space: pre-wrap; word-wrap: break-word;\"><span class=\"\" style=\"color: rgb(85, 85, 85);\">ln -s </span><font color=\"#ff40ff\" class=\"\">libstdc++.so.6.0.22</font><font color=\"#555555\" class=\"\"> libstdc++.so.6</font></pre><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\"><br class=\"\"></div><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">默认动态库升级完成。重新运行以下命令检查动态库：</div><pre class=\"\" style=\"color: rgb(85, 85, 85); white-space: pre-wrap; word-wrap: break-word;\">strings /usr/lib64/libstdc++.so.6 | grep GLIBC</pre><div class=\"\" style=\"color: rgb(85, 85, 85); margin: 0px; padding: 0px;\">现在输出如下：</div><pre class=\"\" style=\"white-space: pre-wrap; word-wrap: break-word;\"><span class=\"\" style=\"color: rgb(85, 85, 85);\">GLIBCXX_3.4\nGLIBCXX_3.4.1\nGLIBCXX_3.4.2\nGLIBCXX_3.4.3\nGLIBCXX_3.4.4\nGLIBCXX_3.4.5\nGLIBCXX_3.4.6\nGLIBCXX_3.4.7\nGLIBCXX_3.4.8\nGLIBCXX_3.4.9\nGLIBCXX_3.4.10\nGLIBCXX_3.4.11\nGLIBCXX_3.4.12\nGLIBCXX_3.4.13\n</span><font color=\"#ff40ff\" class=\"\">GLIBCXX_3.4.14\nGLIBCXX_3.4.15\nGLIBCXX_3.4.16\nGLIBCXX_3.4.17\nGLIBCXX_3.4.18\nGLIBCXX_3.4.19\nGLIBCXX_3.4.20\nGLIBCXX_3.4.21(这些都红色标注是旧版本没有的,所以可以识别为新版本)</font><font color=\"#555555\" class=\"\">\nGLIBC_2.3\nGLIBC_2.2.5\nGLIBC_2.3.2\nGLIBCXX_FORCE_NEW\nGLIBCXX_DEBUG_MESSAGE_LENGTH</font></pre></div>"
    }
  ]
}
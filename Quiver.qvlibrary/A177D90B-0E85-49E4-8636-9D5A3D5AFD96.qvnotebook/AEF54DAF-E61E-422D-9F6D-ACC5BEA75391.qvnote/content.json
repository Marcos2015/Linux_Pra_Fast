{
  "title": "Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)",
  "cells": [
    {
      "type": "text",
      "data": "<p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">今天连接mysql数据库的时候遇到一个问题：Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)</p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">&nbsp;</p><p class=\"p2\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><span class=\"s1\">参考网上相关的方法，包括：（<a href=\"http://blog.csdn.net/lmss82/archive/2009/08/05/4414178.aspx\">http://blog.csdn.net/lmss82/archive/2009/08/05/4414178.aspx</a>）</span></p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">方案1.<br>&nbsp;1.#ps -A|grep mysql&nbsp;<br>&nbsp;&nbsp; 显示类似：<br>&nbsp; 1829 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00:00:00 mysqld_safe<br>&nbsp;&nbsp; 1876 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00:00:31 mysqld<br>&nbsp; 2.#kill -9 1829<br>&nbsp; 3.#kill -9 1876<br>&nbsp; 4.#/etc/init.d/mysql restart<br>&nbsp; 5.#mysql -u root -p<br>&nbsp;<br>&nbsp;&nbsp; 他的麻烦解决了,我的还没解决!<br>&nbsp;<br>继续找<br>方案2&nbsp;<br>先查看 /etc/rc.d/init.d/mysqld status 看看m y s q l 是否已经启动.<br>另外看看是不是权限问题.<br>------------------------------------------------------------------------------------<br>[root@localhost beinan]#chown -R mysql:mysql /var/lib/mysql<br>[root@localhost beinan]# /etc/init.d/mysqld start<br>启动 MySQL： [ 确定 ]<br>[root@localhost lib]# mysqladmin -uroot password '123456'<br>[root@localhost lib]# mysql -uroot -p<br>Enter password:<br>Welcome to the MySQL monitor. Commands end with ; or /g.<br>Your MySQL connection id is 3 to server version: 4.1.11</p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">Type 'help;' or '/h' for help. Type '/c' to clear the buffe<br>&nbsp;<br>他的也解决了,我的麻烦还在继续,依然继续寻找<br>&nbsp;<br>方案3&nbsp;<br>问题解决了，竟然是max_connections=1000 他说太多了，然后改成500也说多，无奈删之问题解决了。<br>&nbsp;<br>还是不行<br>方案4<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp; /var/lib/mysql 所有文件权限 改成mysql.mysql<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp; 不行不行<br>&nbsp;<br>方案5<br>&nbsp;&nbsp;&nbsp;&nbsp; 摘要：解决不能通过mysql .sock连接MySQL问题 这个问题主要提示是，不能通过 '/tmp/mysql .sock'连到服务器，而php标准配置正是用过'/tmp/mysql .sock'，但是一些mysql 安装方法 将 mysql .sock放在/var/lib/mysql .sock或者其他的什么地方，你可以通过修改/etc/my.cnf文件来修正它，打开文件，可以看到如下的东东：&nbsp;<br>&nbsp;　　[mysql d]&nbsp;<br>　　socket=/var/lib/mysql .sock&nbsp;<br>　　改一下就好了，但也会引起其他的问题，如mysql 程序连不上了，再加一点：&nbsp;<br>　　[mysql ]&nbsp;<br>　　socket=/tmp/mysql .sock&nbsp;<br>　　或者还可以通过修改php.ini中的配置来使php用其他的mysql .sock来连，这个大家自己去找找<br>　　<br>　　或者用这样的方法:<br>　　ln -s /var/lib/mysql /mysql .sock /tmp/mysql .sock</p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">成功了,就是这样ln -s /var/lib/mysql /mysql .sock /tmp/mysql .sock</p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">OK!</p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">&nbsp;</p><p class=\"p3\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">但我的系统中没有找到<span class=\"s2\"><b>mysql.sock</b></span>文件，只有<span class=\"s2\"><b>mysqld.sock</b></span>文件，/var/run/mysqld/mysqld.sock</p><p class=\"p3\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">于是仿照上面的做法： ln -s /var/run/mysqld/mysqld.sock /tmp/mysql.sock</p><p class=\"p3\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">这样，可以正常连接数据库了</p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">&nbsp;</p><p class=\"p2\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><span class=\"s1\">再附一篇相关文章：（<a href=\"http://blog.chinaunix.net/u1/43706/showart_351145.html\">http://blog.chinaunix.net/u1/43706/showart_351145.html</a>）</span></p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><span class=\"s3\">&nbsp;mysql_real_connect()</span>试图建立到运行<span class=\"s3\">host</span>的一个<b>MySQL</b>数据库引擎的一个连接。其函数原形为：</p><p class=\"p4\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">&nbsp;&nbsp; MYSQL *mysql_real_connect(MYSQL *mysql, const char *host, const char *user, const char *passwd, const char *db, unsigned int port, const char *unix_socket, unsigned int client_flag)<span class=\"s4\">&nbsp;&nbsp;&nbsp;</span></p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">&nbsp;&nbsp; 我要编一段程序用来远程连接一个mysql数据库。我在数据库的本机上做试验，发现mysql_real_connect()的第二个参数设为\"localhost\"时可以正常连接，当改写为该机器的IP地址\"192.168.100.2\"时就连接失败。我在程序中写的原句为：</p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">mysql_real_connect(mysql,\"192.168.100.2\",\"root\",\"\",\"mydns\",0,NULL,0)。</p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">&nbsp;</p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">&nbsp;&nbsp; 最初，我以为将\"localhost\"改为\"192.168.100.2\"之后要将第六个参数端口号写上，但还是不行。由于我是在Linux上做的，所以想也许需要将第七个参数unix_socket写上，结果还是不行。于是到google找解决方法，发现要远程连接mysql需要为mysql的指定帐号设置远程连接的权限。在我的程序中，就要为root设置这一权限。事实证明，我之前连接失败正是由于这个原因导致的。但问题是，网上被广泛转贴的方法是错误的，我照做后还不行，最后问了同学才解决的。下面我具体说一下，望大家不会再被误导。</p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">&nbsp;</p><p class=\"p5\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><span class=\"s1\">&nbsp;&nbsp;&nbsp;</span>在mysql数据库中有一个mysql库，它里面包含一个user表，里面存有所有帐号及它们的权限及特征。对应我的user表中找到User项为root的，发现有两项，其Host项分别为localhost和localhost.localdomain。<span class=\"s5\"><b>我们只需要把'localhost'改为'%'就可以让所有远程机器以root帐号登陆mysql服务器。也可以将'localhost'改为某一个ip地址，这样就可以在该地址的机器上登陆mysql服务器</b></span>。这些都没有问题，只是网上被广为传颂的一个更改Host项的方法是错误的。他的方法是用update语句将指定User项的Host项改过来，如果想添加一个新的用于远程访问的帐号，就用insert语句添加。事实是这根本不行，我按照作了，表是变了，但还是连不上。后来经过询问才知道，要想改，结合我的情况，必须用下面的这条语句：</p><p class=\"p6\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><span class=\"s6\">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;grant all privileges on mydns.* to&nbsp;<a href=\"mailto:'root'@'%25'\">'root'@'%'</a>；</p><p class=\"p5\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">来改变root帐号的权限。如果添加新帐号也是如此。想必这个表比较特殊，用普通的SQL语句不能操作。如果帐号有密码，后面再加上identified by '***'(*为你帐号的密码)就可以了。</p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">&nbsp;</p><p class=\"p1\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">&nbsp;&nbsp;&nbsp;为了解决这个问题用了一下午的时间，费了不少周折，写出来也能让大家少走些弯路。</p>"
    }
  ]
}
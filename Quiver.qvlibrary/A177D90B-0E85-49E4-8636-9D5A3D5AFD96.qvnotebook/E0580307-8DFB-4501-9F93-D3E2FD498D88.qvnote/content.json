{
  "title": "启动mysql错误解决方案，学会查看错误日志：mysql.sock丢失，mysqld_safe启动报错",
  "cells": [
    {
      "type": "text",
      "data": "<h1 style=\"color: rgb(0, 0, 0); font-family: Arial;\"><span class=\"link_title\"><a href=\"http://blog.csdn.net/dyllove98/article/details/9736039\">启动mysql错误解决方案，学会查看错误日志：mysql.sock丢失，mysqld_safe启动报错</a></span></h1><div class=\"article_manage\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><span class=\"link_postdate\">2013-08-03 21:52</span>&nbsp;<span class=\"link_view\" title=\"阅读次数\">1478人阅读</span>&nbsp;<span class=\"link_comments\" title=\"评论次数\"><a href=\"http://blog.csdn.net/dyllove98/article/details/9736039#comments\">评论</a>(0)</span>&nbsp;<span class=\"link_collect\"><a title=\"收藏\">收藏</a></span>&nbsp;<span class=\"link_report\"><a href=\"http://blog.csdn.net/dyllove98/article/details/9736039#report\" title=\"举报\">举报</a></span></div><div id=\"cnblogs_post_body\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><p>本人还是个菜鸟，下面是我的经验之谈，能解决一些问题，有不对的地方，敬请斧正。</p><p>我的是CentOS6.3+MySQL5.1.57。</p><p>重启了一次服务器后，使用&gt; mysql -u root -p登陆是出现下面的错误：</p><p>ERROR 2002 (HY000): Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)</p><p>于是，我检察mysql状态：</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&gt;&nbsp;/etc/rc.d/init.d/mysqld &nbsp;status &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 显示stop，未运行。</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&gt;/etc/rc.d/init.d/mysqld &nbsp;restart</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Stopping mysqld: [ OK ]</p><h1><span style=\"font-size: 14px;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MySQL Daemon failed to start.</span></h1><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Starting mysqld: [ FAILED]</p><p><em>&nbsp; &nbsp; &nbsp; &nbsp;&gt;ps -ef | grep mysql</em></p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;root 28221 27474 0 14:18 pts/0 00:00:00 grep mysql &nbsp; 只有这一条</p><p>至此，我可以确定，mysql无法启动。</p><p>我开始排错，首先发现/tmp/mysql.sock不存在</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &gt;vim /etc/my.cnf</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;socket=/var/lib/mysql/mysql .sock</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;/var/lib/mysql/mysql .sock同样不存在</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &gt;find / -name mysql.sock</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 显示为空，未查询到mysql.sock文件，mysql.sock文件丢失了。</p><p><span style=\"line-height: 1.5;\">我看网上有人说</span><span style=\"line-height: 1.5;\">mysql.sock套接字文件</span><span style=\"line-height: 1.5;\">可以简单地通过重启服务器重新创建得到它，</span></p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&gt;init 6 &nbsp; &nbsp; &nbsp;重启命令</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;重启后发现错误还是那样，没有任何改变，mysql.sock重启服务器未自动生成。</p><p>接下来了解到mysql.sock是一个临时文件,在mysql启动时会自动生成,我的服务器未启动，自然就没有mysql.sock文件。</p><p>我尝试安全启动模式，mysqld_safe试图通过工作目录找到服务器和数据库，但mysqld_safe还是失败。</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&gt;mysqld_safe &amp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Starting mysqld daemon with databases from ....../mysql/var&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STOPPING server from&nbsp;pid file &nbsp;&nbsp;.......pid<br></p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;130802 15:17:11 mysqld ended</p><p>各种命令尝试无效的情况下，我开始了本次最大的收获----学会看错误日志。</p><p><img src=\"quiver-image-url/A0C9C41B852AD1544A30ED9CEC150D44.png\" alt=\"\" width=\"425\" height=\"171\"></p><p>在错误日志中，启动失败的原因极为明显，file ‘./mysql-bin。000004’ not found，failed to open！</p><p>&nbsp;mysql开启了bin日志功能，到数据库根目录查看该文件是存在的，可能是文件权限的问题。</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&gt;chown -R mysql:mysql /....../mysql/var</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&gt;mysqld_safe &amp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&gt;/etc/rc.d/init.d/mysqld &nbsp;restart</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Stopping mysqld: [ OK ]</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Starting mysqld: [&nbsp;OK]</p><p><img src=\"quiver-image-url/3A3B4260A3813FEC3B9E3DDE47F56222.png\" alt=\"\" width=\"407\" height=\"39\"></p><p>&nbsp; &nbsp;成功启动了！~</p><p><img src=\"quiver-image-url/3579D7E42B7C80F7BBECEF4D0AB1E97F.png\" alt=\"\" width=\"383\" height=\"27\"></p><p>&nbsp; 此时mysql.sock文件出现了，在/var/lib/mysql/mysql .sock。如下图所示，以”s”开头的文件都是socket文件。</p><p><img src=\"quiver-image-url/D1D3AB7FDC204DBFDBDDD99EE7D46142.png\" alt=\"\" width=\"311\" height=\"17\"></p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt; mysql -u root -p</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ERROR 2002 (HY000): Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)</p><p>/tmp/mysql.sock</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 解决这个错误很简单，因为/tmp/mysql.sock不存在，用这样的方法:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;ln -s /var/lib/mysql/mysql .sock &nbsp; /tmp/mysql .sock</p><p><img src=\"quiver-image-url/F9C45A35DA9C282F580A43B256200F6B.png\" alt=\"\" width=\"504\" height=\"18\"></p><p>以”l”开头的文件是软链接文件。或者可以通过修改/etc/my.cnf文件来修正它。</p><p><img src=\"quiver-image-url/36E38D58F815929D6C7C66ADBBFC609E.png\" alt=\"\" width=\"474\" height=\"57\"></p><p>&nbsp; &nbsp;成功解决了！~</p><p>就是这样一个问题折腾了我这么久，错误日志让它无所遁形。查看错误日志可以明确问题所在，而不是像我之前那样盲目的找错。</p><p>俗话说授人以鱼不如授人以渔，学会查看日志，你也可以方便快捷的解决问题了。</p><p>错误使人进步，我与这个错误斗争了四个多小时，对linux的“一切皆文件”这句话有了更深的了解，对我学习文件系统管理（目录树）有很大的帮助，让我的思维真正的从windows操作系统转向成linux系统。并最终解决问题，很有成就感，我喜欢这种感觉。</p><p>希望能对阅读的你有所帮助，谢谢！~</p></div>"
    }
  ]
}
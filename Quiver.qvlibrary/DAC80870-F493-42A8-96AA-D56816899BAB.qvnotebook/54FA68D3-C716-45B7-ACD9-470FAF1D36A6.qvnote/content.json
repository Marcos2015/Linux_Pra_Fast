{
  "title": "VMWare克隆后Ubuntu的“No such device eth0”错误",
  "cells": [
    {
      "type": "text",
      "data": "<p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">环境：VMWare ESX4.0，<a href=\"http://www.linuxidc.com/topicnews.aspx?tid=2\" target=\"_blank\" title=\"Ubuntu\" style=\"color: rgb(179, 43, 213);\">Ubuntu</a>&nbsp;9.10 Server</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">　　在本地为Ubuntu创建VMWare的虚拟机后，复制，创建一个新的克隆镜像，启动，网卡无效，显示错误”eth0: ERROR while getting interface flags: No such device”。</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">原因</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">新克隆的虚拟机镜像的网卡mac地址已经变更。打开虚拟机的.vmx文件，ethernet0.generatedAddress项记录了该虚拟机的mac地址。</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">查看所有适配器信息</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">ifconfig -a</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">发现除了原来的eth0外，Ubuntu已经将新网卡命名为eth1。<br>Ubuntu保存网卡mac地址和设备名的配置文件在</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">/etc/udev/rules.d/70-persistent-net.rules</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">网卡的网络配置保存在</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">/etc/network/interfaces<br>该配置文件中只有原来eth0的配置信息。<br>解决方案1<br>移动/删除rules文件。（未验证）&nbsp;<br>重启后Ubuntu会创建新的rules文件。&nbsp;<br>将新网卡辨认为eth0，沿用原eth0的网络配置。&nbsp;<br>如果网络配置是自动获取IP，则无需做其他修改。</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">sudo mv /etc/udev/rules.d/70-persistent-net.rules<br>&nbsp;&nbsp;&nbsp; /etc/udev/rules.d/70-persistent-net.rules.old</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">解决方案2</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">修改rules文件。（未验证）</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">sudo pico /etc/udev/rules.d/70-persistent-net.rules</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">原内容如下</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\"># PCI device 0x1022:0x2000 (pcnet32)<br>SUBSYSTEM==\"net\", ACTION==\"add\", DRIVERS==\"?*\",<br>&nbsp;&nbsp;&nbsp; ATTR{address}==\"00:0c:29:50:xx:xx\", ATTR{type}==\"1\", NAME=\"eth0\"</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\"># PCI device 0x1022:0x2000 (pcnet32)<br>SUBSYSTEM==\"net\", ACTION==\"add\", DRIVERS==\"?*\",<br>&nbsp;&nbsp;&nbsp; ATTR{address}==\"00:0c:29:36:xx:xx\", ATTR{type}==\"1\", NAME=\"eth1\"</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">删除eth1的配置，用eth1的mac地址替代eth0的mac地址。</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\"># PCI device 0x1022:0x2000 (pcnet32)<br>SUBSYSTEM==\"net\", ACTION==\"add\", DRIVERS==\"?*\",<br>&nbsp;&nbsp;&nbsp; ATTR{address}==\"00:0c:29:36:xx:xx\", ATTR{type}==\"1\", NAME=\"eth0\"</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">重启后Ubuntu同样会将新网卡辨认为eth0，沿用原eth0的网络配置。&nbsp;<br>如果网络配置是自动获取IP，则无需做其他修改。</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">解决方案3</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">修改interfaces文件。（已验证）</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">sudo pico /etc/network/interfaces</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify;\">将所有的eth0替换为eth1。&nbsp;<br>如果是静态地址则同时修改相应设置。</p>"
    }
  ]
}
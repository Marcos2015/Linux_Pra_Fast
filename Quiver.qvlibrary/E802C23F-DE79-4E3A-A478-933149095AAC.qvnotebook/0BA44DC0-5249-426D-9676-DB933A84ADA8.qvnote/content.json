{
  "title": "教会你Linux Shell自动交互的三种方法",
  "cells": [
    {
      "type": "text",
      "data": "<div style=\"word-wrap: break-word; -webkit-nbsp-mode: space; line-break: after-white-space; position: relative;\"><div class=\"brief bgF8F8F8\" style=\"font-size: 12px; background-color: rgb(248, 248, 248); width: 597px; padding: 12px 18px 0px; margin-top: 10px; border-top-color: rgb(216, 217, 217); border-right-color: rgb(216, 217, 217); border-left-color: rgb(216, 217, 217); border-top-width: 1px; border-right-width: 1px; border-left-width: 1px; border-style: solid solid none; color: rgb(51, 51, 51); font-family: 宋体;\"><div class=\"msg\" style=\"color: rgb(105, 105, 105); line-height: 36px; text-align: center; position: relative;\"><div class=\"\">2009-12-09 14:22 佚名 计世网 字号：<span class=\"f14-b\" style=\"font-family: arial; font-weight: bold; font-size: 14px;\"><a target=\"_self\" class=\"\" style=\"color: rgb(0, 66, 118);\">T</a></span>&nbsp;|&nbsp;<span class=\"f16-b\" style=\"font-family: arial; font-weight: bold; font-size: 16px;\"><a target=\"_self\" class=\"\" style=\"color: rgb(0, 66, 118);\">T</a></span></div><div class=\"fav\" style=\"width: 49px; height: 38px; padding: 4px 0px 0px 8px; position: absolute; top: 5px; right: 0px;\"><a title=\"一键收藏，随时查看，分享好友！\" target=\"_self\" class=\"\" style=\"color: rgb(0, 66, 118);\"><img id=\"<56F55CC1-1166-4328-8D04-81468BCC6115>\" alt=\"一键收藏，随时查看，分享好友！\" border=\"0\" apple-inline=\"yes\" class=\"Apple-web-attachment\" src=\"quiver-image-url/325CDFFF0BC39DDF51710D55ECE4A12E.gif\" subtitle=\"正在下载…\" progress=\"0.01\" style=\"border: medium none;\" width=\"49\" height=\"18\"></a></div></div><div class=\"brieftext\" style=\"background-color: rgb(255, 255, 255); border: 1px dashed rgb(115, 160, 207); line-height: 26px; padding: 8px 12px;\"><div class=\"\" style=\"margin: 0px; padding: 0px; color: rgb(0, 102, 0); font-size: 14px;\">你了解Linux系统么？你是Linux系统的应用者么？如果你要学习linux，你可能会遇到Linux Shell自动交互问题，这里将介绍Linux Shell自动交互的解决方法，在这里拿出来和大家分享一下。</div><div class=\"\" style=\"margin: 0px; padding: 0px; text-align: right;\">AD：<a href=\"http://mobile.51cto.com/mobile/mdsa12/\" target=\"_blank\" class=\"\" style=\"color: red; text-decoration: none; margin: 5px;\">51CTO 网+ 第十二期沙龙：大话数据之美_如何用数据驱动用户体验</a></div></div></div><div class=\"content f14 bgF8F8F8\" style=\"font-size: 14px; background-color: rgb(248, 248, 248); padding: 12px 18px 0px; border-right-color: rgb(216, 217, 217); border-bottom-color: rgb(216, 217, 217); border-left-color: rgb(216, 217, 217); border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-style: none solid solid; line-height: 28px; margin-bottom: 10px; position: relative; min-height: 500px; overflow: hidden; color: rgb(51, 51, 51); font-family: 宋体;\"><div id=\"content\" class=\"\"><div class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\"><br class=\"webkit-block-placeholder\"></div><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">你了解Linux系统么？你是Linux系统的应用者么？如果你要学习linux，你可能会遇到Linux Shell自动交互问题，这里将介绍Linux Shell自动交互的解决方法，在这里拿出来和大家分享一下。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">一、背景</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">shell脚本在处理自动循环或大的任务方面可节省大量的时间，通过创建一个处理任务的命令清单，使用变量、条件、算术和循环等方法快速创建脚本以完成相应工作，这比在命令行下一个个敲入命令要省时省力得多。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">但是有时候我们可能会需要实现和交互程序如ftp,telnet服务器等进行交互的功能，这时候我们需要用到shell的自动交互功能，本文收集了较常用的三种自动交互方法，并进行了比较和总结。&nbsp;</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">二、需求</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">需求1：<br class=\"\" style=\"clear: both; width: 0px; height: 0px;\">从一台Linux机器ftp登陆到另一台Linux机器，进行系列操作后关闭，懒得每次都手动输入密码。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">需求2：<br class=\"\" style=\"clear: both; width: 0px; height: 0px;\">改变登录用户密码，懒得每次都输入新旧密码。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">需求3：<br class=\"\" style=\"clear: both; width: 0px; height: 0px;\">希望su自动登录到root账户，懒得每次都输入root密码。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">三、调试环境</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">终端：SecureCRT</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">系统：WinXP, CentOS 4.4(VmWare)</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">Shell:bash</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">注：shell有很多种，B类SHELL（sh, bash, ksh）之间行为相近；C类SHELL（csh, tcsh）之间行为相近，还有zsh和rc等shell，本文的调试环境是bash。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">四、自动交互方法一</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">自动交互最关键的就是交互信息的自动输入，首先联想到文件重定向，在shell编程中有这样一种用法(参考Linux与UNIX SHELL编程指南 chapt 5.7)：\"command &lt;&lt; delimiter&nbsp; 从标准输入中读入，直至遇到delimiter分界符。\"</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">重定向操作符command &lt;&lt; delimiter是一种非常有用的命令，shell将分界符delimiter之后直至下一个同样的分界符之前的所有内容都作为输入，遇到下一个分界符， shell就知道输入结束了。最常见的delimiter分界符是EOF，当然完全可以自定为其他字符。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">对于需求1 要求的自动登陆ftp，并作系列操作，则可以用这种方法进行自动交互。代码如下：</p><pre class=\"\" style=\"margin-top: 0px; padding: 0px; font-family: &quot;Courier New&quot;, monospace; font-size: 12px; width: 591.015625px; overflow: auto; background-color: rgb(230, 230, 230);\"><ol class=\"dp-xml\" style=\"padding: 5px 0px; color: rgb(92, 92, 92); list-style-position: initial; list-style-image: initial; word-wrap: break-word; word-break: normal; border: none; background-color: rgb(247, 247, 247); margin: 0px 0px 1px 3em !important;\"><li class=\"alt\" style=\"color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">#!/bin/bash &nbsp;</span></li><li class=\"\" style=\"list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">ftp&nbsp;-i&nbsp;-n&nbsp;192.168.167.187&nbsp;</span><strong class=\"\"><font color=\"#006699\" class=\"\"><span class=\"tag\" style=\"margin: 0px 0px 10px; padding: 7px 0px 4px; border: none; width: 635px; line-height: 18px;\">&lt;</span><span class=\"tag\" style=\"margin: 0px 0px 10px; padding: 7px 0px 4px; border: none; width: 635px; line-height: 18px;\">&lt;</span></font></strong><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">&nbsp;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold;\">EOF</span><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">&nbsp;</span></li><li class=\"alt\" style=\"color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">user&nbsp;hzc&nbsp;123456 &nbsp;</span></li><li class=\"\" style=\"list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">pwd &nbsp;</span></li><li class=\"alt\" style=\"color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">cd&nbsp;test &nbsp;</span></li><li class=\"\" style=\"list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">pwd &nbsp;</span></li><li class=\"alt\" style=\"color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">close &nbsp;</span></li><li class=\"\" style=\"list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">bye &nbsp;</span></li><li class=\"alt\" style=\"color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">EOF&nbsp;</span></li></ol></pre><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">测试可以发现，如上代码使用帐号名hzc，密码123456成功登陆了ftp服务器，并进入目录，打印出了pwd。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">五、自动交互方法二</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">需求2中要求采用非交互的方式改变登录用户密码，尝试用方法1，无法实现。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">这时候联想到交互信息的另一个自动输入方法，管道，通过echo + sleep + | 可以实现这个需求。</p><pre class=\"\" style=\"margin-top: 0px; padding: 0px; font-family: &quot;Courier New&quot;, monospace; font-size: 12px; width: 591.015625px; overflow: auto; background-color: rgb(230, 230, 230);\"><ol class=\"dp-xml\" style=\"padding: 5px 0px; color: rgb(92, 92, 92); list-style-position: initial; list-style-image: initial; word-wrap: break-word; word-break: normal; border: none; background-color: rgb(247, 247, 247); margin: 0px 0px 1px 3em !important;\"><li class=\"alt\" style=\"color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">#!/bin/bash &nbsp;</span></li><li class=\"\" style=\"list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">(echo&nbsp;\"curpassword\" &nbsp;</span></li><li class=\"alt\" style=\"color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">sleep&nbsp;1 &nbsp;</span></li><li class=\"\" style=\"list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">echo&nbsp;\"newpassword\"&nbsp; &nbsp;</span></li><li class=\"alt\" style=\"color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">sleep&nbsp;1 &nbsp;</span></li><li class=\"\" style=\"list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">echo&nbsp;\"newpassword\")|passwd&nbsp;</span></li></ol></pre><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">测试通过，运行这个脚本，直接把当前用户的curpassword改成newpassword。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">六、自动交互方法三</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">需求3中要求自动登录root账号，尝试方法1和方法2，都出现错误提示standard in must be a tty。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">这时候尝试寻找外部帮助，一个shell工具expect可以实现这个功能，其实expect就是一个专门用来实现自动交互功能的工具，expect的语法可以参考相关资料，代码如下：</p><pre class=\"\" style=\"margin-top: 0px; padding: 0px; font-family: &quot;Courier New&quot;, monospace; font-size: 12px; width: 591.015625px; overflow: auto; background-color: rgb(230, 230, 230);\"><ol class=\"dp-xml\" style=\"padding: 5px 0px; color: rgb(92, 92, 92); list-style-position: initial; list-style-image: initial; word-wrap: break-word; word-break: normal; border: none; background-color: rgb(247, 247, 247); margin: 0px 0px 1px 3em !important;\"><li class=\"alt\" style=\"color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">#!/usr/bin/expect &nbsp;</span></li><li class=\"\" style=\"list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">spawn&nbsp;su&nbsp;root &nbsp;</span></li><li class=\"alt\" style=\"color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">expect&nbsp;\"password:&nbsp;\" &nbsp;</span></li><li class=\"\" style=\"list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">send&nbsp;\"123456\\r\" &nbsp;</span></li><li class=\"alt\" style=\"color: inherit; list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">expect&nbsp;eof &nbsp;</span></li><li class=\"\" style=\"list-style: none; word-wrap: break-word; word-break: normal; border: none; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-image: url(http://images.51cto.com/images/art1105/images/0.gif) !important; background-attachment: scroll !important; background-position: -498px -70px !important; background-repeat: no-repeat repeat !important;\"><span class=\"\" style=\"margin: 0px; padding: 0px; border: none; color: black;\">exit&nbsp;</span></li></ol></pre><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">测试通过，运行这个脚本，直接从当前用户登录到root用户。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">七、方法总结</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">方法一(重定向)简单直观，也经常有实际应用，但是在自动交互领域功能有限。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">方法二(管道)也很简单直观，有时甚至不用sleep配合就能展现强大的自动交互实力，但是在某些时候也束手无策。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">方法三(expect)在功能上是最为强大的，expect本来就是为实现自动交互功能而生，但是缺点是需要安装expect包，在嵌入式等环境下难以安装。</p><p class=\"\" style=\"margin: 10px 0px; padding: 0px; text-indent: 28px;\">三个方法各有优劣，应用的好，都可以完成Linux Shell自动交互。</p></div></div></div>"
    }
  ]
}
{
  "title": "Shell脚本交互之：自动输入密码",
  "cells": [
    {
      "type": "text",
      "data": "<div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">平时在控制台输入指令如：sudo、ssh、ftp或者修改admin权限的文件时候都会要求输入password，但是在she'll脚本运行过程中该如何交互实现自动输入密码呢？</span></div><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">下面总结三种实现方法。</span></div><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">一、重定向：用重定向方法实现交互的前提是指令需要有参数来指定密码输入方式，如ftp就有-i参数来指定使用标准输入来输入密码</span></div><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">&nbsp; &nbsp; &nbsp; &nbsp; shell用重定向作为标准输入的用法是：cmd&lt;&lt;delimiter ,shell 会将分界符delimiter之后直到下一个同样的分界符之前的内容作为输入</span></div><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">&nbsp;<span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; white-space: pre;\"> </span>实现ftp自动登录并运行ls指令的用法如下：其中zjk为用户名，zjk123为密码 &nbsp; &nbsp; &nbsp; &nbsp;</span></div><p class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"></p><pre code_snippet_id=\"1640511\" snippet_file_name=\"blog_20160409_1_1475715\" name=\"code\" class=\"html\" style=\"box-sizing: border-box; font-family: Arial, &quot;Microsoft YaHei&quot;; white-space: pre-wrap; padding: 0px; margin-top: 0px; margin-bottom: 0px; line-height: 1.428571429; color: rgb(51, 51, 51); word-break: break-all; word-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow: hidden; width: 1385px;\">ftp -i -n 192.168.21.46 &lt;&lt;EOF\nuser zjk zjk123\nls\nEOF</pre><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-family: Arial, &quot;Microsoft YaHei&quot;; color: rgb(51, 51, 51); font-size: 18px;\"><br class=\"\" style=\"box-sizing: border-box;\">二：管道：跟重定向一样，指令同样要有参数来指定密码输入方式，如sudo的-S参数，passwd的-stdin参数</span><span class=\"\" style=\"color: rgb(51, 51, 51); font-family: sans-serif; font-size: 24px; background-color: rgb(255, 255, 255);\"></span><p class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"></p><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">&nbsp; &nbsp; &nbsp; &nbsp;所以实现sudo自动输入密码的脚本如下：其中zjk123为密码</span></div><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">&nbsp; &nbsp; &nbsp;&nbsp;<span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; background-color: rgb(240, 240, 240);\">echo 'zjk123' | sudo -S cp file1 /etc/hosts</span><br class=\"\" style=\"box-sizing: border-box;\">&nbsp; &nbsp; &nbsp; 实现自动修改密码的脚本写法如下：</span></div><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">&nbsp; &nbsp; &nbsp;&nbsp;<span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; background-color: rgb(240, 240, 240);\">echo 'password' | passwd -stdin username</span><br class=\"\" style=\"box-sizing: border-box;\"><br class=\"\" style=\"box-sizing: border-box;\"></span></div><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">三：expect：上面介绍的两种方法前提条件是指令有参数来设定密码输入方式，像ssh指令就没有这样的参数，第三种交互方式就派上用场了</span></div><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">&nbsp; &nbsp; &nbsp; &nbsp;expect就是用来做交互用的，基本任何交互登录的场合都能使用，但是需要安装expect包</span></div><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">&nbsp; &nbsp; &nbsp; 语法如下：</span></div><p class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\"></span></p><pre code_snippet_id=\"1640511\" snippet_file_name=\"blog_20160409_2_635900\" name=\"code\" class=\"html\" style=\"box-sizing: border-box; font-family: Arial, &quot;Microsoft YaHei&quot;; white-space: pre-wrap; padding: 0px; margin-top: 0px; margin-bottom: 0px; line-height: 1.428571429; color: rgb(51, 51, 51); word-break: break-all; word-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow: hidden; width: 1385px;\">#!/bin/expect\nset timeout 30\nspawn ssh -l jikuan.zjk 10.125.25.189\nexpect \"password:\"\nsend \"zjk123\\r\"\ninteract</pre><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-family: Arial, &quot;Microsoft YaHei&quot;; color: rgb(51, 51, 51); font-size: 18px;\">注意：expect跟bash类似，使用时要先登录到expect，所以首行要指定使用expect</span><span class=\"\" style=\"color: rgb(51, 51, 51); font-family: sans-serif; font-size: 24px; background-color: rgb(255, 255, 255);\"></span><p class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"></p><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">在运行脚本时候要expect &nbsp;file，不能sh file了</span></div><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">上面语句第一句是设定超时时间为30s，spawn是expect的语句，执行命令前都要加这句</span></div><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">expect \"password：\"这句意思是交互获取是否返回password：关键字，因为在执行ssh时会返回输入password的提示：<a href=\"mailto:jikuan.zjk@10.125.25.189\" class=\"\">jikuan.zjk@10.125.25.189</a>'s password:</span></div><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">send就是将密码zjk123发送过去</span></div><div class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0.2rem 0px 0.3rem; font-family: Arial, &quot;Microsoft YaHei&quot;; font-size: 0.7rem; color: rgb(51, 51, 51); line-height: 0.875rem; word-break: break-all;\"><span class=\"\" style=\"box-sizing: border-box; margin: 0px; padding: 0px; font-size: 18px;\">interact代表执行完留在远程控制台，不加这句执行完后返回本地控制台&nbsp;</span></div>"
    }
  ]
}
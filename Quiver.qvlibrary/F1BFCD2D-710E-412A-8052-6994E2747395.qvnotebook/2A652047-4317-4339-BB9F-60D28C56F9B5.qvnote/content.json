{
  "title": "apue源代码的使用与编译",
  "cells": [
    {
      "type": "text",
      "data": "<div style=\"color: rgb(0, 0, 0); line-height: 1.7; font-size: 14px; font-family: arial;\"><div class=\"post\" style=\"padding-left: 20px; font-size: 13px; color: rgb(170, 170, 170); font-family: georgia, Verdana, Helvetica, Arial; line-height: 19px;\"><div class=\"postcontent\" style=\"margin-top: 10px; background-repeat: no-repeat no-repeat;\"><div id=\"cnblogs_post_body\"><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\">最近在读 Richard Stevens 的大作《UNIX环境高级编程》，相信很多初读此书的人都会与我一样遇到这个问题，编译书中的程序实例时会出现问题，提示 “错误：apue.h：没有那个文件或目录”。</p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\">apue.h 是作者自定义的一个头文件，并不是Unix/Linux系统自带的，此头文件包括了Unix程序所需的常用头文件及作者Richard自己写的出错处理函数。所以在默认情况下，gcc在编译时是读不到这个头文件的。</p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\">先在这个网站&nbsp;<a href=\"http://www.apuebook.com/\" target=\"_blank\" style=\"color: rgb(41, 112, 166); text-decoration: none; margin: 0px; padding: 0px;\">http://www.apuebook.com/</a>&nbsp;下载tar.gz格式的源码包，然后解压至某个目录，比如说/home/yarkee/下，然后进入目录apue.2e，把文件Make.defines.linux 中的 WKDIR=/home/xxx/apue.2e 修改为 WKDIR=/home/yarkee/apue.2e ，然后再进入apue.2e目录下的std目录，打开linux.mk，将里面的nawk全部替换为awk，如果是用的vi/vim编辑器，可以使用这个命令 &nbsp;:1.$s/nawk/awk/g&nbsp;（注意前面有冒号）<br>然后在此目录下运行make命令，即回到 /home/yarkee/apue.2e 目录在终端中输入 “./make” (不含引号)</p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\">然后把 /home/yarkee/apue.2e/inlcude 目录下的 apue.h 文件和位于 /home/yarkee/apue.2e/lib 目录下的 error.c 文件都复制到 /usr/include 目录下，注意复制这两个文件你需要有root权限。之所以要这样做，是因为gcc在链接头文件时会到 /usr/include 这个目录下寻找需要的头文件，若找不到则报错。</p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\">最终还要编辑一下复制过来的 apue.h 文件<br>在最后一行 #endif&nbsp;前面添加一行 #include “error.c”</p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\"><br></p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\"><span style=\"margin: 0px; padding: 0px; font-family: Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;\"></span></p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\">错误与解决</p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\">gcc -DLINUX -ansi -I/home/sdoning/apue/apue.2e/include -Wall -D_GNU_SOURCE&nbsp;&nbsp; -c -o getenv1.o getenv1.c<br>getenv1.c:4: error: ‘ARG_MAX’ undeclared here (not in a function)<br>make[2]: *** [getenv1.o] Error 1<br>make[2]: Leaving directory `/home/sdoning/apue/apue.2e/threadctl’<br>make[1]: *** [linux] Error 1<br>make[1]: Leaving directory `/home/sdoning/apue/apue.2e’<br>make: *** [all] Error 2</p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\">解决方法：</p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\">在apue.2e/include/apue.h中添加一行：<br>#define ARG_MAX 4096<br>打开apue.2e/threadctl/getenv3.c（包括getenv1.c），添加一行：<br>#include \"apue.h\"</p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\">再次编译即可。</p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\"><br></p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\"><br></p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\"><br></p><p style=\"padding-top: 0px; padding-bottom: 0px; font-family: Tahoma, 'Microsoft Yahei'; font-size: 14px; line-height: 14.666666984558105px; color: rgb(51, 51, 51); margin: 10px auto !important;\">还是建议自己写一遍，被错误提示改成printf</p></div><div id=\"MySignature\" style=\"margin-top: 10px;\"></div><div class=\"clear\" style=\"clear: both;\"></div><div id=\"blog_post_info_block\" style=\"margin-top: 20px;\"><div id=\"blog_post_info\"><div id=\"BlogPostCategory\">分类:&nbsp;<a href=\"http://www.cnblogs.com/notepi/category/489391.html\" style=\"color: rgb(141, 140, 140); text-decoration: none;\">APUE学习</a></div></div></div></div></div></div><br style=\"color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px;\"><br style=\"color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px;\"><span title=\"neteasefooter\" style=\"color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px;\"><span id=\"netease_mail_footer\"><div id=\"netease_mail_footer\"><div style=\"border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); padding: 10px 5px; color: rgb(102, 102, 102); line-height: 22px;\">来自网易手机号码邮箱<a id=\"mobile_set\" sys=\"1\" log=\"1\" logid=\"free_sms_20120504\" href=\"http://shouji.163.com/\" target=\"_blank\" style=\"color: rgb(0, 0, 255);\">了解更多</a></div></div></span></span>"
    }
  ]
}
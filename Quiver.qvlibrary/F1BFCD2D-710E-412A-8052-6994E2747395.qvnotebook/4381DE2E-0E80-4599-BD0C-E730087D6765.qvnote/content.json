{
  "title": "关于字符串的赋值和strcpy 的区别",
  "cells": [
    {
      "type": "text",
      "data": "<br><div id=\"articlecontent\" style=\"color: rgb(0, 0, 0); font-family: Arial; width: 958px; overflow: hidden; font-size: 16px; line-height: 24px;\"><p style=\"padding: 0px; margin: 10px 0px;\"><span style=\"padding: 0px; margin: 0px; font-size: 13px;\">使用常量字符串初始化char指针，或者使用strcpy复制，从语法上我觉得都是可以的。但是，在这个例子中选择了后者，我觉得是有其他考虑的。<br>因为，ctermid_name是全局的，可能用来传送数据，将str指向这个地址，可能会和其他的函数同步一个内存变量；而使用常量初始化：str=\"/dev/tty\"，那么系统会分配地址，这样str的地址是随机的。<br><br><br>个人认为区别在于这里。<br><br><br></span><span style=\"padding: 0px; margin: 0px; font-size: 13px;\">“str=\"/dev/tty\"，那么系统会分配地址，这样str的地址是随机的。”<br><br>系统没有分配地址，str的数值是固定的。就和全局ctermid_name是固定的一样。因为\"/dev/tty\"是固定地址。</span>&nbsp;<br><br><span style=\"padding: 0px; margin: 0px; font-size: 13px;\">在看APUE时遇到一个问题，问题如下：<br><br>#include&nbsp; &nbsp;&nbsp;&nbsp;&lt;stdio.h&gt;<br>#include&nbsp; &nbsp;&nbsp;&nbsp;&lt;string.h&gt;<br><br>static char ctermid_name[L_ctermid];<br><br>char *<br>ctermid(char *str)<br>{<br>&nbsp; &nbsp; if (str == NULL)<br>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;str = ctermid_name;<br>&nbsp; &nbsp; return(strcpy(str, \"/dev/tty\"));&nbsp; &nbsp; /* strcpy() returns str */<br>}<br><br>在这个函数里，为啥用strcpy给指针赋值，而不直接赋值呢？<br></span><br><span style=\"padding: 0px; margin: 0px; font-size: 13px;\"><br>用以下简图来说明楼主的问题,直接赋值和拷贝是不一样的且为什么用拷贝而不用直接赋值.<br>&nbsp; &nbsp;&nbsp;&nbsp;strcpy(str.\"/dev/tty\")<br>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;______________<br>str--------&gt;|__|__|__|__|__|<br>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;^<br>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;|copy过去 覆盖原有内容.<br>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; ________|_____<br>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;|/dev/tty/0&nbsp; &nbsp;&nbsp; &nbsp;|<br>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; ----------------<br>str=\"/dev/tty\"<br><br>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;____________<br>str&lt;------|/dev/tty/0&nbsp; &nbsp;&nbsp; &nbsp;| 只把字符指针传给str,而str指的原来区域的内容未改变.引起的可能后果就<br>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;---------------<br>是原来str指向的那块内存丢失,内存泄漏</span></p></div>"
    }
  ]
}
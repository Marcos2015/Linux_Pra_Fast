{
  "title": "字节对齐的细节",
  "cells": [
    {
      "type": "text",
      "data": "<div style=\"color: rgb(0, 0, 0); line-height: 1.7; font-size: 14px; font-family: arial;\"><div class=\"para\" style=\"margin-bottom: 14px; text-indent: 30px; font-family: arial, 宋体, sans-serif; line-height: 24px;\"><a target=\"_blank\" href=\"http://baike.baidu.com/view/1523557.htm\" style=\"color: rgb(19, 110, 194);\">字节对齐</a>的细节和<a target=\"_blank\" href=\"http://baike.baidu.com/view/487018.htm\" style=\"color: rgb(19, 110, 194);\">编译器</a>实现相关，但一般而言，满足三个准则：</div><div class=\"para\" style=\"margin-bottom: 14px; text-indent: 30px; font-family: arial, 宋体, sans-serif; line-height: 24px;\">1)&nbsp;<a target=\"_blank\" href=\"http://baike.baidu.com/view/204974.htm\" style=\"color: rgb(19, 110, 194);\">结构体</a><a target=\"_blank\" href=\"http://baike.baidu.com/view/296689.htm\" style=\"color: rgb(19, 110, 194);\">变量</a>的首地址能够被其最宽基本类型成员的大小所整除；</div><div class=\"para\" style=\"margin-bottom: 14px; text-indent: 30px; font-family: arial, 宋体, sans-serif; line-height: 24px;\">2)&nbsp;<a target=\"_blank\" href=\"http://baike.baidu.com/view/204974.htm\" style=\"color: rgb(19, 110, 194);\">结构体</a>每个成员相对于结构体首地址的<a target=\"_blank\" href=\"http://baike.baidu.com/view/1254177.htm\" style=\"color: rgb(19, 110, 194);\">偏移量</a>（offset）都是成员大小的整数倍，如有需要<a target=\"_blank\" href=\"http://baike.baidu.com/view/487018.htm\" style=\"color: rgb(19, 110, 194);\">编译器</a>会在成员之间加上填充字节（internal padding）；</div><div class=\"para\" style=\"margin-bottom: 14px; text-indent: 30px; font-family: arial, 宋体, sans-serif; line-height: 24px;\">3)&nbsp;<a target=\"_blank\" href=\"http://baike.baidu.com/view/204974.htm\" style=\"color: rgb(19, 110, 194);\">结构体</a>的总大小为结构体最宽基本类型成员大小的整数倍，如有需要<a target=\"_blank\" href=\"http://baike.baidu.com/view/487018.htm\" style=\"color: rgb(19, 110, 194);\">编译器</a>会在最末一个成员之后加上填充字节（trailing padding）。</div><div class=\"para\" style=\"margin-bottom: 14px; text-indent: 30px; font-family: arial, 宋体, sans-serif; line-height: 24px;\">对于上面的准则，有几点需要说明：</div><div class=\"para\" style=\"margin-bottom: 14px; text-indent: 30px; font-family: arial, 宋体, sans-serif; line-height: 24px;\">1) 前面不是说<a target=\"_blank\" href=\"http://baike.baidu.com/view/204974.htm\" style=\"color: rgb(19, 110, 194);\">结构体</a>成员的地址是其大小的整数倍，怎么又说到<a target=\"_blank\" href=\"http://baike.baidu.com/view/1254177.htm\" style=\"color: rgb(19, 110, 194);\">偏移量</a>了呢因为有了第1点存在，所以我们就可以只考虑成员的偏移量，这样思考起来简单。想想为什么。</div><div class=\"para\" style=\"margin-bottom: 14px; text-indent: 30px; font-family: arial, 宋体, sans-serif; line-height: 24px;\"><a target=\"_blank\" href=\"http://baike.baidu.com/view/204974.htm\" style=\"color: rgb(19, 110, 194);\">结构体</a>某个成员相对于结构体首地址的<a target=\"_blank\" href=\"http://baike.baidu.com/view/1254177.htm\" style=\"color: rgb(19, 110, 194);\">偏移量</a>可以通过宏offsetof()来获得，这个宏也在<a target=\"_blank\" href=\"http://baike.baidu.com/view/3555591.htm\" style=\"color: rgb(19, 110, 194);\">stddef.h</a>中定义，如下：</div><div class=\"para\" style=\"margin-bottom: 14px; text-indent: 30px; font-family: arial, 宋体, sans-serif; line-height: 24px;\">#define offsetof(s,m) (size_t)&amp;(((s *)0)-&gt;m)</div><div class=\"para\" style=\"margin-bottom: 14px; text-indent: 30px; font-family: arial, 宋体, sans-serif; line-height: 24px;\">例如，想要获得S2中c的<a target=\"_blank\" href=\"http://baike.baidu.com/view/1254177.htm\" style=\"color: rgb(19, 110, 194);\">偏移量</a>，方法为</div><div class=\"para\" style=\"margin-bottom: 14px; text-indent: 30px; font-family: arial, 宋体, sans-serif; line-height: 24px;\">size_t pos = offsetof(S2, c);// pos等于4</div></div><br style=\"color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px;\"><br style=\"color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px;\"><span title=\"neteasefooter\" style=\"color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px;\"><span id=\"netease_mail_footer\"><div id=\"netease_mail_footer\"><div style=\"border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); padding: 10px 5px; color: rgb(102, 102, 102); line-height: 22px;\">来自网易手机号码邮箱<a id=\"mobile_set\" sys=\"1\" log=\"1\" logid=\"free_sms_20120504\" href=\"http://shouji.163.com/\" target=\"_blank\" style=\"color: rgb(0, 0, 255);\">了解更多</a></div></div></span></span>"
    }
  ]
}
{
  "title": "CString 转换 Char* 最安全方法",
  "cells": [
    {
      "type": "text",
      "data": "<div class=\"article_title\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><h1><br></h1></div><div class=\"article_manage\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><span class=\"link_categories\">分类：&nbsp;<a href=\"http://blog.csdn.net/baijiaheizhiganmao/article/category/1624287\">C++</a>&nbsp;</span><span class=\"link_postdate\">2015-02-10 11:25</span>&nbsp;<span class=\"link_view\" title=\"阅读次数\">49人阅读</span>&nbsp;<span class=\"link_comments\" title=\"评论次数\"><a href=\"http://blog.csdn.net/wangshiqilin_fjy/article/details/43700903#comments\">评论</a>(0)</span>&nbsp;<span class=\"link_collect\"><a title=\"收藏\">收藏</a></span>&nbsp;<span class=\"link_report\"><a href=\"http://blog.csdn.net/wangshiqilin_fjy/article/details/43700903#report\" title=\"举报\">举报</a></span></div><div class=\"tag2box\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><a href=\"http://www.csdn.net/tag/C%2b%2b\" target=\"_blank\">C++</a></div><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">CString转换char*&nbsp;网上方法很多,但是,有些博客提供的方法简直就是滥竽充数!!!</p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">比如:</p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">cstring temp(\"http\");<br></p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">char * ptr=(LPSTR)(LPCTSTR)temp;</p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">该方法将导致运行的时候弹出堆栈错误,编译器连调试的机会都不给你直接抛出异常,然后程序死亡!<br></p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><br></p><p style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">最安全的方法只有这一种:</p><div class=\"dp-highlighter bg_cpp\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><div class=\"bar\"><div class=\"tools\"><b>[cpp]</b>&nbsp;<a href=\"http://blog.csdn.net/wangshiqilin_fjy/article/details/43700903#\" class=\"ViewSource\" title=\"view plain\">view plain</a><a href=\"http://blog.csdn.net/wangshiqilin_fjy/article/details/43700903#\" class=\"CopyToClipboard\" title=\"copy\">copy</a><a href=\"http://blog.csdn.net/wangshiqilin_fjy/article/details/43700903#\" class=\"PrintSource\" title=\"print\">print</a><a href=\"http://blog.csdn.net/wangshiqilin_fjy/article/details/43700903#\" class=\"About\" title=\"?\">?</a><a href=\"https://code.csdn.net/snippets/601549\" target=\"_blank\" title=\"在CODE上查看代码片\"><img src=\"quiver-image-url/BA3ACBF6D7A3420D26DB10207385A617.png\" alt=\"在CODE上查看代码片\" height=\"16\" width=\"16\" style=\"position: relative; top: 1px; left: 2px;\"></a><a href=\"https://code.csdn.net/snippets/601549/fork\" target=\"_blank\" title=\"派生到我的代码片\"><img src=\"quiver-image-url/02725C4F62B67DC23F2B87E776850078.svg\" alt=\"派生到我的代码片\" height=\"0\" width=\"0\" style=\"position: relative; top: 2px; left: 2px;\"></a></div></div><ol class=\"dp-cpp\" start=\"1\"><li class=\"alt\">CString&nbsp;str=_T(<span class=\"string\">\"hello&nbsp;kitty&nbsp;12345&nbsp;hello&nbsp;jackson\"</span>);&nbsp;&nbsp;</li><li class=\"\"><span class=\"datatypes\">int</span>&nbsp;len=str.GetLength();&nbsp;&nbsp;</li><li class=\"alt\">&nbsp;&nbsp;</li><li class=\"\"><span class=\"datatypes\">char</span>&nbsp;*buffer=<span class=\"keyword\">new</span>&nbsp;<span class=\"datatypes\">char</span>[len+1];&nbsp;&nbsp;</li><li class=\"alt\">memset(buffer,0,len+1);&nbsp;&nbsp;</li><li class=\"\">&nbsp;&nbsp;</li><li class=\"alt\">WideCharToMultiByte(CP_OEMCP,&nbsp;NULL,&nbsp;(<span class=\"datatypes\">LPCWSTR</span>)str,&nbsp;-1,NULL,&nbsp;0,&nbsp;NULL,&nbsp;FALSE);&nbsp;&nbsp;</li><li class=\"\">WideCharToMultiByte(CP_OEMCP,&nbsp;NULL,&nbsp;(<span class=\"datatypes\">LPCWSTR</span>)str,&nbsp;-1,(<span class=\"datatypes\">LPSTR</span>)buffer,&nbsp;len,&nbsp;NULL,&nbsp;FALSE);&nbsp;&nbsp;</li><li class=\"alt\">&nbsp;&nbsp;</li><li class=\"\">buffer[len]=<span class=\"string\">'\\0'</span>;&nbsp;&nbsp;</li></ol></div><span style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\">可以进行封装,比如:</span><div class=\"dp-highlighter bg_cpp\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><div class=\"bar\"><div class=\"tools\"><b>[cpp]</b>&nbsp;<a href=\"http://blog.csdn.net/wangshiqilin_fjy/article/details/43700903#\" class=\"ViewSource\" title=\"view plain\">view plain</a><a href=\"http://blog.csdn.net/wangshiqilin_fjy/article/details/43700903#\" class=\"CopyToClipboard\" title=\"copy\">copy</a><a href=\"http://blog.csdn.net/wangshiqilin_fjy/article/details/43700903#\" class=\"PrintSource\" title=\"print\">print</a><a href=\"http://blog.csdn.net/wangshiqilin_fjy/article/details/43700903#\" class=\"About\" title=\"?\">?</a><a href=\"https://code.csdn.net/snippets/601549\" target=\"_blank\" title=\"在CODE上查看代码片\"><img src=\"quiver-image-url/BA3ACBF6D7A3420D26DB10207385A617.png\" alt=\"在CODE上查看代码片\" height=\"16\" width=\"16\" style=\"position: relative; top: 1px; left: 2px;\"></a><a href=\"https://code.csdn.net/snippets/601549/fork\" target=\"_blank\" title=\"派生到我的代码片\"><img src=\"quiver-image-url/02725C4F62B67DC23F2B87E776850078.svg\" alt=\"派生到我的代码片\" height=\"0\" width=\"0\" style=\"position: relative; top: 2px; left: 2px;\"></a></div></div><ol class=\"dp-cpp\" start=\"1\"><li class=\"alt\"><span class=\"datatypes\">char</span>*&nbsp;CRtfControle::CString2Char(CString&nbsp;txt)&nbsp;&nbsp;</li><li class=\"\">{&nbsp;&nbsp;</li><li class=\"alt\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"datatypes\">int</span>&nbsp;len&nbsp;=&nbsp;txt.GetLength();&nbsp;&nbsp;</li><li class=\"\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"datatypes\">char</span>*&nbsp;ctXt&nbsp;=&nbsp;<span class=\"keyword\">new</span>&nbsp;<span class=\"datatypes\">char</span>[len+1];&nbsp;&nbsp;</li><li class=\"alt\">&nbsp;&nbsp;&nbsp;&nbsp;memset(ctXt,0,len+1);&nbsp;&nbsp;</li><li class=\"\">&nbsp;&nbsp;&nbsp;&nbsp;WideCharToMultiByte(CP_OEMCP,&nbsp;NULL,&nbsp;(<span class=\"datatypes\">LPCWSTR</span>)txt,&nbsp;-1,NULL,&nbsp;0,&nbsp;NULL,&nbsp;FALSE);&nbsp;&nbsp;</li><li class=\"alt\">&nbsp;&nbsp;&nbsp;&nbsp;WideCharToMultiByte(CP_OEMCP,&nbsp;NULL,&nbsp;(<span class=\"datatypes\">LPCWSTR</span>)txt,&nbsp;-1,(<span class=\"datatypes\">LPSTR</span>)ctXt,&nbsp;len,&nbsp;NULL,&nbsp;FALSE);&nbsp;&nbsp;</li><li class=\"\">&nbsp;&nbsp;&nbsp;&nbsp;ctXt[len]=<span class=\"string\">'\\0'</span>;&nbsp;&nbsp;</li><li class=\"alt\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\">return</span>&nbsp;ctXt;&nbsp;&nbsp;</li><li class=\"\">} &nbsp;</li></ol></div>"
    }
  ]
}
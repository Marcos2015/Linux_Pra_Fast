{
  "title": "linux下项目开发中防止重复定义和重复包含的方法",
  "cells": [
    {
      "type": "text",
      "data": "<div style=\"color: rgb(0, 0, 0); line-height: 1.7; font-size: 14px; font-family: arial;\"><div class=\"article_title\" style=\"margin: 5px 0px; font-size: 20px; line-height: 30px; font-family: 'Microsoft YaHei';\"><span style=\"font-family: 宋体;\">我们在网上下载的</span><span lang=\"EN-US\" style=\"font-family: Arial;\"><span style=\"font-family: Calibri;\">c</span></span><span style=\"font-family: 宋体;\">或</span><span style=\"font-family: Calibri;\">&nbsp;<span lang=\"EN-US\">c++&nbsp;</span></span><span style=\"font-family: 宋体;\">源码，当你打开其中的头文件时，如果你是一个心细的计算机爱好者你会发现他们写的头文件都包含在一个条件编译中。比如：</span><br></div><div id=\"article_content\" class=\"article_content\" style=\"margin: 20px 0px 0px; line-height: 26px; font-family: Arial;\"><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#ifndef CLOCK_H</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#define CLOCK_H</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-size: small;\"><span style=\"font-family: 宋体;\">源码部分</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">………………….</span></span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">&nbsp;</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">&nbsp;</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#endif //CLOCK_H</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-family: 宋体;\"><span style=\"font-size: small;\">好了，现在说一说它们的作用。</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-size: small;\"><span style=\"font-family: 宋体;\">这个条件编译的作用不体现在这个文件中，而是体现在整个</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">project</span></span><span style=\"font-family: 宋体;\">中。</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-size: small;\"><span style=\"font-family: 宋体;\">我们一般在</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">linux&nbsp;</span></span><span style=\"font-family: 宋体;\">下做开发时，</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">project</span></span><span style=\"font-family: 宋体;\">文件和</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">makefile</span></span><span style=\"font-family: 宋体;\">文件</span><span style=\"font-family: Calibri;\">&nbsp;</span><span style=\"font-family: 宋体;\">要用工具生成或者自己书写。</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-size: small;\"><span style=\"font-family: 宋体;\">我们在建立</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">project&nbsp;</span></span><span style=\"font-family: 宋体;\">里的文件时一般一个功能建立一个</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">&nbsp;*.h</span></span><span style=\"font-family: 宋体;\">和</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">*.cpp</span></span><span style=\"font-family: 宋体;\">文件，而在含有</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">main</span></span><span style=\"font-family: 宋体;\">函数的文件里包含所有的头文件。</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-family: 宋体;\"><span style=\"font-size: small;\">我们为了说明条件编译的意义，简单举例。</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-family: 宋体;\"><span style=\"font-size: small;\">下面有五个文件：</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-size: small;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">Test1.h Test2.h&nbsp;</span></span><span style=\"font-family: 宋体;\">这两个头文件</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-size: small;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">Test1.cpp Test2.cpp</span></span><span style=\"font-family: 宋体;\">两个</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">cpp</span></span><span style=\"font-family: 宋体;\">文件</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-size: small;\"><span style=\"font-family: 宋体;\">一个</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">main.cpp</span></span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">&nbsp;</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-family: 宋体;\"><span style=\"font-size: small;\">其内容如下：</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Test1.h:</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#include&lt;stdio.h&gt;</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">&nbsp;</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Test2.h:</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#include” Test1.h”</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Test1.cpp</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#include” Test1.h”</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Void pf1()</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">{</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Printf(“hello world!/n ok1”);</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">&nbsp;</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">}</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Test2.cpp:</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#include” Test2.h”</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Void pf2()</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">{</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Printf(“hello world /n ok2”);</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">&nbsp;</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">}</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Main.cpp</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#include” Test1.h”</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#include” Test2.h”</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Int main()</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">{</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Pf1();</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Pf2();</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">return 0;</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">&nbsp;</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">}</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-size: small;\"><span style=\"font-family: 宋体;\">这样直接生成</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">project</span></span><span style=\"font-family: 宋体;\">文件和</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">makefile</span></span><span style=\"font-family: 宋体;\">文件会出现错误。原因很简单，你重复包含了</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">#include&lt;stdio.h&gt;</span></span><span style=\"font-family: 宋体;\">。</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-family: 宋体;\"><span style=\"font-size: small;\">解决这个问题的办法很简单，用一开始提到的条件编译。</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-family: 宋体;\"><span style=\"font-size: small;\">把修改如下：</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Test1.h:</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#ifndef TEST</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#define TEST</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#include&lt;stdio.h&gt;</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#endf</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">Test2.h:</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#ifndef TEST2</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#define TEST2</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#include “Test1.h”</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">#endf</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-size: small;\"><span style=\"font-family: 宋体;\">这样修改之后，就能保证你的头文件只能被包含一次。这样，你在建立整个</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">project</span></span><span style=\"font-family: 宋体;\">时就不用考虑该包含那个头文件，以防止重复包含。</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-size: small;\"><span style=\"font-family: 宋体;\">还有，像这样用条件编译解决重复定义的用法很多。比如你要在一个文件中定义一些全局变量，而你又不想在其它包含它的所有文件都用</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">extern</span></span><span style=\"font-family: 宋体;\">声明。</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-family: 宋体;\"><span style=\"font-size: small;\">你可以用这样的策略：在你定义全局变量的头文件里用条件编译方法。</span></span></p><p class=\"MsoNormal\" align=\"left\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\" style=\"font-family: KNLe, serif; color: rgb(128, 64, 64); font-size: 12pt;\">#ifdef&nbsp;&nbsp;&nbsp;OS_GLOBALS</span><span lang=\"EN-US\" style=\"font-family: KNLe, serif; font-size: 12pt;\"></span></p><p class=\"MsoNormal\" align=\"left\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\" style=\"font-family: KNLe, serif; color: rgb(128, 64, 64); font-size: 12pt;\">#define&nbsp;&nbsp;OS_EXT</span><span lang=\"EN-US\" style=\"font-family: KNLe, serif; font-size: 12pt;\"></span></p><p class=\"MsoNormal\" align=\"left\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\" style=\"font-family: KNLe, serif; color: rgb(128, 64, 64); font-size: 12pt;\">#else</span><span lang=\"EN-US\" style=\"font-family: KNLe, serif; font-size: 12pt;\"></span></p><p class=\"MsoNormal\" align=\"left\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\" style=\"font-family: KNLe, serif; color: rgb(128, 64, 64); font-size: 12pt;\">#define&nbsp;&nbsp;OS_EXT&nbsp;&nbsp;extern</span><span lang=\"EN-US\" style=\"font-family: KNLe, serif; font-size: 12pt;\"></span></p><p class=\"MsoNormal\" align=\"left\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\" style=\"font-family: KNLe, serif; color: rgb(128, 64, 64); font-size: 12pt;\">#endif</span><span lang=\"EN-US\" style=\"font-family: KNLe, serif; font-size: 12pt;\"></span></p><p class=\"MsoNormal\" align=\"left\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\" style=\"font-family: KNLe, serif; font-size: 12pt;\">&nbsp;</span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-size: small;\"><span style=\"font-family: 宋体;\">在定义变量时在前面加上</span><span lang=\"EN-US\" style=\"font-family: KNLe, serif; color: rgb(128, 64, 64); font-size: 12pt;\">OS_EXT</span></span><span style=\"font-family: 宋体; color: rgb(128, 64, 64); font-size: 12pt;\">。</span><span lang=\"EN-US\" style=\"font-family: KNLe, serif; color: rgb(128, 64, 64); font-size: 12pt;\"></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-size: small;\"><span style=\"font-family: 宋体;\">在所有引用此头文件的文件里，有一个定义</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">OS_GLOBALS</span></span><span style=\"font-family: 宋体;\">这个，其它所有引用此头文件的文件都不定义</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">OS_GLOBALS</span></span><span style=\"font-family: 宋体;\">。就实现了，声明全局变量的头文件被多次应用但只被定义一次，其它文件是对变量的声明。</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-size: small;\"><span style=\"font-family: 宋体;\">其实这是</span><span lang=\"EN-US\"><span style=\"font-family: Calibri;\">ucos</span></span><span style=\"font-family: 宋体;\">里用的策略。</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-family: 宋体;\"><span style=\"font-size: small;\">其实，我们要想防止重复定义，最好使用条件编译。</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span style=\"font-family: 宋体;\"><span style=\"font-size: small;\">说的可能有点乱，希望对大家有帮助。</span></span></p><p class=\"MsoNormal\" style=\"margin: 0cm 0cm 0pt; padding: 0px;\"><span lang=\"EN-US\"><span style=\"font-family: Calibri; font-size: small;\">&nbsp;</span></span></p></div></div><br style=\"color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px;\"><br style=\"color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px;\"><span title=\"neteasefooter\" style=\"color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px;\"><span id=\"netease_mail_footer\"><div id=\"netease_mail_footer\"><div style=\"border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); padding: 10px 5px; color: rgb(102, 102, 102); line-height: 22px;\">来自网易手机号码邮箱<a id=\"mobile_set\" sys=\"1\" log=\"1\" logid=\"free_sms_20120504\" href=\"http://shouji.163.com/\" target=\"_blank\" style=\"color: rgb(0, 0, 255);\">了解更多</a></div></div></span></span>"
    }
  ]
}
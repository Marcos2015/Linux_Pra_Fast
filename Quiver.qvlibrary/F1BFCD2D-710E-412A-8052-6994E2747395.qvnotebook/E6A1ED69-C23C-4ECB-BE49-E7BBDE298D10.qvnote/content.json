{
  "title": "Linux 有问必答：如何知道进程运行在哪个 CPU 内核上？",
  "cells": [
    {
      "type": "text",
      "data": "<embed id=\"xunlei_com_thunder_helper_plugin_d462f475-c18e-46be-bd10-327458d045bd\" type=\"application/thunder_download_plugin\" height=\"0\" width=\"0\" style=\"color: rgb(0, 0, 0); font-family: Arial; font-size: 14px;\"><span style=\"color: rgb(0, 0, 0); font-size: 14px; font-family: Tahoma, Helvetica, SimSun, sans-serif; line-height: 2em;\">当你在</span><span style=\"color: rgb(0, 0, 0); font-size: 14px; font-family: Tahoma, Helvetica, SimSun, sans-serif; line-height: 2em;\">&nbsp;</span><a href=\"http://xmodulo.com/identify-cpu-processor-architecture-linux.html\" class=\"ext\" rel=\"external nofollow\" style=\"font-size: 14px; font-family: Tahoma, Helvetica, SimSun, sans-serif; line-height: 2em; word-wrap: break-word; color: rgb(77, 138, 216); text-decoration: none;\">多核 NUMA 处理器上</a><span style=\"color: rgb(0, 0, 0); font-size: 14px; font-family: Tahoma, Helvetica, SimSun, sans-serif; line-height: 2em;\">运行需要较高性能的 HPC（高性能计算）程序或非常消耗网络资源的程序时，CPU/memory 的亲和力是限度其发挥最大性能的重要因素之一。在同一 NUMA 节点上调度最相关的进程可以减少缓慢的远程内存访问。像英特尔 Sandy Bridge 处理器，该处理器有一个集成的 PCIe 控制器，你可以在同一 NUMA 节点上调度网络 I/O 负载（如网卡）来突破 PCI 到 CPU 亲和力限制。</span><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">作为性能优化和故障排除的一部分，你可能想知道特定的进程被调度到哪个 CPU 内核（或 NUMA 节点）上运行。</p><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">这里有几种方法可以&nbsp;<strong style=\"word-wrap: break-word; color: rgb(196, 15, 15);\">找出哪个 CPU 内核被调度来运行给定的 Linux 进程或线程</strong>。</p><a id=\"3_1135\" class=\"target-fix ext\" rel=\"external nofollow\" style=\"font-size: 14px; word-wrap: break-word; color: rgb(77, 138, 216); position: relative; top: -40px; display: block; height: 0px; overflow: hidden; font-family: Tahoma, Helvetica, SimSun, sans-serif; line-height: 25px;\"></a><h3 id=\"toc_1\" style=\"color: rgb(0, 0, 0); word-wrap: break-word; margin: 6px 0px 3px; padding: 0px; font-size: 1.1em; font-family: 'Microsoft YaHei', 'Hiragino Sans GB', STHeiti, Tahoma, SimHei, sans-serif; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: rgb(47, 47, 47); width: 714.59375px;\">方法一</h3><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">如果一个进程使用&nbsp;<a href=\"http://xmodulo.com/run-program-process-specific-cpu-cores-linux.html\" class=\"ext\" rel=\"external nofollow\" style=\"word-wrap: break-word; color: rgb(77, 138, 216); text-decoration: none;\">taskset</a>&nbsp;命令明确的被固定（pinned）到 CPU 的特定内核上，你可以使用 taskset 命令找出被固定的 CPU 内核：</p><pre class=\"prettyprint linenums prettyprinted\" style=\"font-size: 14px; background-color: rgb(51, 51, 51); border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; color: rgb(238, 238, 238); margin: 10px; padding: 1em 1em 1em 2em; border: 2px solid rgb(0, 170, 255); line-height: 25px;\"><ol class=\"linenums\" style=\"word-wrap: break-word; padding: 1px; border-left-width: 2px; border-left-style: solid; border-left-color: rgb(0, 153, 0); color: rgb(174, 174, 174); background-color: rgb(52, 52, 52); margin: 1em !important;\"><li class=\"L0\" style=\"word-wrap: break-word; margin: 0px; padding: 0px; list-style-type: decimal; line-height: 1.5em !important;\"><code style=\"word-wrap: break-word; color: rgb(238, 238, 238); background-image: none; padding-top: 0px !important; padding-bottom: 0px !important; padding-left: 10px !important; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 0px !important; border-bottom-left-radius: 0px !important; margin-top: 1em !important; margin-bottom: 1em !important; border: none !important;\"><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">$ taskset </span><span class=\"pun\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">-</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">c </span><span class=\"pun\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">-</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">p </span><span class=\"pun\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">&lt;</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">pid</span><span class=\"pun\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">&gt;</span></code></li></ol></pre><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">例如, 如果你对 PID 5357 这个进程有兴趣:</p><pre class=\"prettyprint linenums prettyprinted\" style=\"font-size: 14px; background-color: rgb(51, 51, 51); border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; color: rgb(238, 238, 238); margin: 10px; padding: 1em 1em 1em 2em; border: 2px solid rgb(0, 170, 255); line-height: 25px;\"><ol class=\"linenums\" style=\"word-wrap: break-word; padding: 1px; border-left-width: 2px; border-left-style: solid; border-left-color: rgb(0, 153, 0); color: rgb(174, 174, 174); background-color: rgb(52, 52, 52); margin: 1em !important;\"><li class=\"L0\" style=\"word-wrap: break-word; margin: 0px; padding: 0px; list-style-type: decimal; line-height: 1.5em !important;\"><code style=\"word-wrap: break-word; color: rgb(238, 238, 238); background-image: none; padding-top: 0px !important; padding-bottom: 0px !important; padding-left: 10px !important; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 0px !important; border-bottom-left-radius: 0px !important; margin-top: 1em !important; margin-bottom: 1em !important; border: none !important;\"><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">$ taskset </span><span class=\"pun\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">-</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">c </span><span class=\"pun\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">-</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">p </span><span class=\"lit\" style=\"word-wrap: break-word; color: rgb(51, 135, 204);\">5357</span><br style=\"word-wrap: break-word;\"></code><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">pid </span><span class=\"lit\" style=\"word-wrap: break-word; color: rgb(51, 135, 204);\">5357</span><span class=\"str\" style=\"word-wrap: break-word; color: rgb(101, 176, 66);\">'s current affinity list: 5</span></li></ol></pre><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">输出显示这个过程被固定在 CPU 内核 5上。</p><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">但是，如果你没有明确固定进程到任何 CPU 内核，你会得到类似下面的亲和力列表。</p><pre class=\"prettyprint linenums prettyprinted\" style=\"font-size: 14px; background-color: rgb(51, 51, 51); border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; color: rgb(238, 238, 238); margin: 10px; padding: 1em 1em 1em 2em; border: 2px solid rgb(0, 170, 255); line-height: 25px;\"><ol class=\"linenums\" style=\"word-wrap: break-word; padding: 1px; border-left-width: 2px; border-left-style: solid; border-left-color: rgb(0, 153, 0); color: rgb(174, 174, 174); background-color: rgb(52, 52, 52); margin: 1em !important;\"><li class=\"L0\" style=\"word-wrap: break-word; margin: 0px; padding: 0px; list-style-type: decimal; line-height: 1.5em !important;\"><code style=\"word-wrap: break-word; color: rgb(238, 238, 238); background-image: none; padding-top: 0px !important; padding-bottom: 0px !important; padding-left: 10px !important; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 0px !important; border-bottom-left-radius: 0px !important; margin-top: 1em !important; margin-bottom: 1em !important; border: none !important;\"><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">pid </span><span class=\"lit\" style=\"word-wrap: break-word; color: rgb(51, 135, 204);\">5357</span><span class=\"str\" style=\"word-wrap: break-word; color: rgb(101, 176, 66);\">'s current affinity list: 0-11</span></code></li></ol></pre><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">输出表明该进程可能会被安排在从0到11中的任何一个 CPU 内核。在这种情况下，taskset 不能识别该进程当前被分配给哪个 CPU 内核，你应该使用如下所述的方法。</p><a id=\"3_2176\" class=\"target-fix ext\" rel=\"external nofollow\" style=\"font-size: 14px; word-wrap: break-word; color: rgb(77, 138, 216); position: relative; top: -40px; display: block; height: 0px; overflow: hidden; font-family: Tahoma, Helvetica, SimSun, sans-serif; line-height: 25px;\"></a><h3 id=\"toc_2\" style=\"color: rgb(0, 0, 0); word-wrap: break-word; margin: 6px 0px 3px; padding: 0px; font-size: 1.1em; font-family: 'Microsoft YaHei', 'Hiragino Sans GB', STHeiti, Tahoma, SimHei, sans-serif; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: rgb(47, 47, 47); width: 714.59375px;\">方法二</h3><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">ps 命令可以告诉你每个进程/线程目前分配到的 （在“PSR”列）CPU ID。</p><pre class=\"prettyprint linenums prettyprinted\" style=\"font-size: 14px; background-color: rgb(51, 51, 51); border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; color: rgb(238, 238, 238); margin: 10px; padding: 1em 1em 1em 2em; border: 2px solid rgb(0, 170, 255); line-height: 25px;\"><ol class=\"linenums\" style=\"word-wrap: break-word; padding: 1px; border-left-width: 2px; border-left-style: solid; border-left-color: rgb(0, 153, 0); color: rgb(174, 174, 174); background-color: rgb(52, 52, 52); margin: 1em !important;\"><li class=\"L0\" style=\"word-wrap: break-word; margin: 0px; padding: 0px; list-style-type: decimal; line-height: 1.5em !important;\"><code style=\"word-wrap: break-word; color: rgb(238, 238, 238); background-image: none; padding-top: 0px !important; padding-bottom: 0px !important; padding-left: 10px !important; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 0px !important; border-bottom-left-radius: 0px !important; margin-top: 1em !important; margin-bottom: 1em !important; border: none !important;\"><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">$ </span><span class=\"kwd\" style=\"word-wrap: break-word; color: rgb(226, 137, 100);\">ps</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\"> </span><span class=\"pun\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">-</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">o pid</span><span class=\"pun\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">,</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">psr</span><span class=\"pun\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">,</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">comm </span><span class=\"pun\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">-</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">p </span><span class=\"pun\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">&lt;</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">pid</span><span class=\"pun\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">&gt;</span><br style=\"word-wrap: break-word;\"></code><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">  PID PSR COMMAND</span><br style=\"word-wrap: break-word;\"><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\"> </span><span class=\"lit\" style=\"word-wrap: break-word; color: rgb(51, 135, 204);\">5357</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">  </span><span class=\"lit\" style=\"word-wrap: break-word; color: rgb(51, 135, 204);\">10</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\"> prog</span></li></ol></pre><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">输出表示进程的 PID 为 5357（名为\"prog\"）目前在CPU 内核 10 上运行着。如果该过程没有被固定，PSR 列会根据内核可能调度该进程到不同内核而改变显示。</p><a id=\"3_2657\" class=\"target-fix ext\" rel=\"external nofollow\" style=\"font-size: 14px; word-wrap: break-word; color: rgb(77, 138, 216); position: relative; top: -40px; display: block; height: 0px; overflow: hidden; font-family: Tahoma, Helvetica, SimSun, sans-serif; line-height: 25px;\"></a><h3 id=\"toc_3\" style=\"color: rgb(0, 0, 0); word-wrap: break-word; margin: 6px 0px 3px; padding: 0px; font-size: 1.1em; font-family: 'Microsoft YaHei', 'Hiragino Sans GB', STHeiti, Tahoma, SimHei, sans-serif; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: rgb(47, 47, 47); width: 714.59375px;\">方法三</h3><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">top 命令也可以显示 CPU 被分配给哪个进程。首先，在top 命令中使用“P”选项。然后按“f”键，显示中会出现 \"Last used CPU\" 列。目前使用的 CPU 内核将出现在 “P”（或“PSR”）列下。</p><pre class=\"prettyprint linenums prettyprinted\" style=\"font-size: 14px; background-color: rgb(51, 51, 51); border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; color: rgb(238, 238, 238); margin: 10px; padding: 1em 1em 1em 2em; border: 2px solid rgb(0, 170, 255); line-height: 25px;\"><ol class=\"linenums\" style=\"word-wrap: break-word; padding: 1px; border-left-width: 2px; border-left-style: solid; border-left-color: rgb(0, 153, 0); color: rgb(174, 174, 174); background-color: rgb(52, 52, 52); margin: 1em !important;\"><li class=\"L0\" style=\"word-wrap: break-word; margin: 0px; padding: 0px; list-style-type: decimal; line-height: 1.5em !important;\"><code style=\"word-wrap: break-word; color: rgb(238, 238, 238); background-image: none; padding-top: 0px !important; padding-bottom: 0px !important; padding-left: 10px !important; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 0px !important; border-bottom-left-radius: 0px !important; margin-top: 1em !important; margin-bottom: 1em !important; border: none !important;\"><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">$ </span><span class=\"kwd\" style=\"word-wrap: break-word; color: rgb(226, 137, 100);\">top</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\"> </span><span class=\"pun\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">-</span><span class=\"pln\" style=\"word-wrap: break-word; color: rgb(255, 255, 255);\">p </span><span class=\"lit\" style=\"word-wrap: break-word; color: rgb(51, 135, 204);\">5357</span></code></li></ol></pre><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\"><img src=\"quiver-image-url/B545FFF30BE91BF5FC6D4FD91E4EC442.jpg\" alt=\"\" style=\"word-wrap: break-word; max-width: 95%; margin: 10px 15px; width: 734px; cursor: pointer;\" width=\"800\" height=\"278\"></p><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">相比于 ps 命令，使用 top 命令的好处是，你可以连续监视随着时间的改变， CPU 是如何分配的。</p><a id=\"3_3276\" class=\"target-fix ext\" rel=\"external nofollow\" style=\"font-size: 14px; word-wrap: break-word; color: rgb(77, 138, 216); position: relative; top: -40px; display: block; height: 0px; overflow: hidden; font-family: Tahoma, Helvetica, SimSun, sans-serif; line-height: 25px;\"></a><h3 id=\"toc_4\" style=\"color: rgb(0, 0, 0); word-wrap: break-word; margin: 6px 0px 3px; padding: 0px; font-size: 1.1em; font-family: 'Microsoft YaHei', 'Hiragino Sans GB', STHeiti, Tahoma, SimHei, sans-serif; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: rgb(47, 47, 47); width: 714.59375px;\">方法四</h3><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">另一种来检查一个进程/线程当前使用的是哪个 CPU 内核的方法是使用&nbsp;<a href=\"https://linux.cn/article-3141-1.html\" style=\"word-wrap: break-word; color: rgb(247, 110, 110); text-decoration: none;\">htop 命令</a>。</p><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">从命令行启动 htop。按 键，进入\"Columns\"，在\"Available Columns\"下会添加 PROCESSOR。</p><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">每个进程当前使用的 CPU ID 将出现在“CPU”列中。</p><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\"><img src=\"quiver-image-url/FCC2D9FED0CED3C8C9DA1D20D3EE2C45.jpg\" alt=\"\" style=\"word-wrap: break-word; max-width: 95%; margin: 10px 15px; width: 734px; cursor: pointer;\" width=\"800\" height=\"361\"></p><p style=\"color: rgb(0, 0, 0); font-size: 14px; word-wrap: break-word; margin: 10px 0px; padding: 0px; line-height: 2em; font-family: Tahoma, Helvetica, SimSun, sans-serif;\">请注意，所有以前使用的命令 taskset，ps 和 top 分配CPU 内核的 IDs 为 0，1，2，...，N-1。然而，htop 分配 CPU 内核 IDs 从 1开始（直到 N）。</p>"
    }
  ]
}